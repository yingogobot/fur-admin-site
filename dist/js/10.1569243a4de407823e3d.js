(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"79C1":function(t,e,r){},S4mp:function(t,e,r){"use strict";var n=r("DyJX");e.a={getAllResalers:function(t){return new Promise(function(e,r){n.a.post("resaler/get_all",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalersCount:function(){return new Promise(function(t,e){n.a.post("resaler/get_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},addResaler:function(t){return new Promise(function(e,r){n.a.post("resaler/add",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},deleteResaler:function(t){return new Promise(function(e,r){var a={id:t};n.a.post("resaler/delete",a).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllResalerRegions:function(t){return new Promise(function(e,r){n.a.post("resaler/get_all_regions",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerRegionsCount:function(){return new Promise(function(t,e){n.a.post("resaler/get_region_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},addResalerRegion:function(t){return new Promise(function(e,r){n.a.post("resaler/add_region",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addResalerRegionManager:function(t){return new Promise(function(e,r){n.a.post("resaler/add_region_manager",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},removeResalerRegionManager:function(t){return new Promise(function(e,r){n.a.post("resaler/remove_region_manager",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllResalerAreas:function(t){return new Promise(function(e,r){n.a.post("resaler/get_all_areas",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerAreasCount:function(){return new Promise(function(t,e){n.a.post("resaler/get_area_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},addResalerArea:function(t){return new Promise(function(e,r){n.a.post("resaler/add_area",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addResalerAreaManager:function(t){return new Promise(function(e,r){n.a.post("resaler/add_area_manager",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},removeResalerAreaManager:function(t){return new Promise(function(e,r){n.a.post("resaler/remove_area_manager",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerTypes:function(){return new Promise(function(t,e){n.a.post("resaler/get_all_types").then(function(e){return t(e)}).catch(function(t){return e(t)})})}}},Tu2r:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"filter-container"},[r("h2",[t._v("筛选结果")]),t._v(" "),r("el-date-picker",{staticClass:"filter-item",staticStyle:{"margin-left":"15px"},attrs:{type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份"},model:{value:t.listQuery.date,callback:function(e){t.$set(t.listQuery,"date",e)},expression:"listQuery.date"}}),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"分销大区",clearable:""},on:{change:function(e){return t.getAreas(t.listQuery.region_id)}},model:{value:t.listQuery.region_id,callback:function(e){t.$set(t.listQuery,"region_id",e)},expression:"listQuery.region_id"}},t._l(t.resalerRegions,function(t){return r("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"分销地区",clearable:""},on:{change:function(e){return t.getResalers(t.listQuery.resaler_region_id,t.listQuery.area_id)}},model:{value:t.listQuery.area_id,callback:function(e){t.$set(t.listQuery,"area_id",e)},expression:"listQuery.area_id"}},t._l(t.resalerAreas,function(t){return r("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"分销渠道",clearable:""},model:{value:t.listQuery.resaler_id,callback:function(e){t.$set(t.listQuery,"resaler_id",e)},expression:"listQuery.resaler_id"}},t._l(t.resalers,function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"地区经理",clearable:""},model:{value:t.listQuery.area_manager_atm,callback:function(e){t.$set(t.listQuery,"area_manager_atm",e)},expression:"listQuery.area_manager_atm"}},t._l(t.areaManager,function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"大区经理",clearable:""},model:{value:t.listQuery.region_manager_atm,callback:function(e){t.$set(t.listQuery,"region_manager_atm",e)},expression:"listQuery.region_manager_atm"}},t._l(t.regionManager,function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品类型",clearable:""},on:{change:function(e){return t.getSubType(t.listQuery.product_type)}},model:{value:t.listQuery.product_type,callback:function(e){t.$set(t.listQuery,"product_type",e)},expression:"listQuery.product_type"}},t._l(t.productTypes,function(t){return r("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品分类",clearable:""},on:{change:function(e){return t.getSelectedProducts(t.listQuery.product_sub_type)}},model:{value:t.listQuery.product_sub_type,callback:function(e){t.$set(t.listQuery,"product_sub_type",e)},expression:"listQuery.product_sub_type"}},t._l(t.productSubTypes,function(t){return r("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),r("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品",clearable:""},model:{value:t.listQuery.product,callback:function(e){t.$set(t.listQuery,"product",e)},expression:"listQuery.product"}},t._l(t.selectedProducts,function(t){return r("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),r("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{width:"100px","margin-left":"15px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("\n      搜索\n    ")])],1),t._v(" "),r("h2",[t._v("销售详情")]),t._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.sales,"span-method":t.objectSpanMethod,border:"",fit:""}},[r("el-table-column",{attrs:{label:"订单ID",prop:"id",width:"80px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.id))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"分销渠道",prop:"sales_type",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.name))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"所属地区",prop:"sales_type",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.area_title))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"订单归属地区经理",prop:"sales_type",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.area_manager_atm_name))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"所属大区",prop:"sales_type",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.region_title))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"订单归属大区经理",prop:"sales_type",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.region_manager_atm_name))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"销售时间",prop:"sales_type",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(t.moment(n.date).format("YYYY-MM-DD")))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"产品类型",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("el-tag",{staticClass:"tag",attrs:{color:n.tag_color}},[t._v(t._s(n.product_type))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"产品细类",width:"140px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("el-tag",{staticClass:"sub_type_tag",attrs:{color:n.sub_type_tag_color}},[t._v(t._s(n.product_sub_type))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"产品名称",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",{staticClass:"link-type",on:{click:function(e){return t.handleUpdate(n)}}},[t._v(t._s(n.product_title))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"产品型号",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.size))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"销售数量",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.quantity))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"赠送数量",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.promotion_quantity))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"销售价格",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v("￥"+t._s(n.per_item_price_atm))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"单品折扣率",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(1==n.per_product_discount_ratio?"原价":0==n.per_product_discount_ratio?"免费赠品":10*n.per_product_discount_ratio+"折"))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"单品总价",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v("￥"+t._s(n.total_price))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"订单总价",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v("￥"+t._s(n.order_total_price))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"全额付款",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(1===n.fully_paid?"是":"否"))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"云仓订单编号",width:"200px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.deliver_tracking_code))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"备注",width:"250px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(n.note))])]}}])}),t._v(" "),1===t.role?r("el-table-column",{attrs:{label:"编辑订单",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"warning",plain:""},on:{click:function(r){return t.editSale(e.row)}}},[t._v("编辑")])]}}],null,!1,3721199082)}):t._e()],1),t._v(" "),r("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getAllSales}})],1)};n._withStripped=!0;r("f3/d"),r("rGqo");var a=r("23J+"),o=r("xUCC"),i=r("xMja"),s=r("S4mp"),l=r("gZTm"),c=r("wk8/"),u=r("ZySA"),d=r("7Qib"),p=r("Mz3J"),_=r("L2JU"),f=r("wd/R"),h=r.n(f),m={name:"ComplexTable",components:{Pagination:p.a},directives:{waves:u.a},filters:{},data:function(){return{tableKey:0,sales:null,total:0,listLoading:!0,productTypes:[],productSubTypes:[],products:[],resalers:[],resalerRegions:[],resalerAreas:[],areaManager:[],regionManager:[],selectedProducts:[],listQuery:{page:1,limit:10,product_type:void 0,product_sub_type:void 0,area_id:void 0,region_id:void 0,resaler_id:void 0,area_manager_atm:void 0,region_manager_atm:void 0},rowSpans:null}},created:function(){},computed:Object(a.a)({},Object(_.b)(["id","role"])),beforeRouteEnter:function(t,e,r){r(function(t){t.getAllSales(),t.getSalesCount(),t.getProductTypes(),t.getResalers(),t.getAreas(),t.getRegions(),t.getSalesAreaManager(),t.getSalesRegionManager(),r()})},methods:{calculateRowSpan:function(){var t=[],e=0;this.sales.forEach(function(r){var n=!1;if(t.forEach(function(t){t.id===r.id&&(n=!0,t.end++,t.rowSpan++,e=t.start+t.rowSpan)}),!n){var a={id:r.id,start:e,end:e+1,rowSpan:1};e++,t.push(a)}}),this.rowSpans=t},getAllSales:function(){var t=this;this.listLoading=!0,this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=h()(this.listQuery.date[0]).format("YYYY-MM-DD"),this.listQuery.end_date=h()(this.listQuery.date[1]).format("YYYY-MM-DD")),o.a.getAllResalerSales(this.listQuery).then(function(e){t.sales=e,t.listLoading=!1,t.calculateRowSpan()}).catch(function(e){t.$message({message:"getAllSales 读取库存失败，请联系徐神检查",type:"error"}),t.listLoading=!1})},getSalesCount:function(){var t=this;this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=h()(this.listQuery.date[0]).format("YYYY-MM-DD"),this.listQuery.end_date=h()(this.listQuery.date[1]).format("YYYY-MM-DD")),o.a.getAllResalerSalesCount(this.listQuery).then(function(e){t.total=e.total})},getAreas:function(t){var e=this;s.a.getAllResalerAreas({region_id:t,page:1,limit:1e4}).then(function(t){e.resalerAreas=t}).catch(function(t){})},getRegions:function(){var t=this;s.a.getAllResalerRegions({page:1,limit:1e4}).then(function(e){t.resalerRegions=e}).catch(function(t){})},getSalesAreaManager:function(){var t=this;c.a.getAccounts({role:[4,5]}).then(function(e){t.areaManager=e})},getSalesRegionManager:function(){var t=this;c.a.getAccounts({role:[5]}).then(function(e){t.regionManager=e})},getProductTypes:function(){var t=this;i.a.getAllProductType().then(function(e){t.productTypes=e})},getSubType:function(t){this.selectedProducts=[],this.listQuery.product=void 0,this.listQuery.product_sub_type=void 0,this.productSubTypes=t.product_type.sub_type,t&&(t.product_sub_type=void 0,t.product_id=void 0,t.cost=void 0,t.size=void 0,t.quantity=0,t.total_price=0,t.discount=0,t.discount_rate=1)},getSelectedProducts:function(t){var e=this;this.selectedProducts=[],this.listQuery.product=void 0,t&&i.a.getProductBySubType({product_sub_type:t}).then(function(t){e.selectedProducts=t})},getProductBySubType:function(t,e){this.products=t.products,e&&(e.product_id=void 0,e.cost=void 0,e.size=void 0,e.quantity=0,e.total_price=0,e.discount=0,e.discount_rate=1)},getResalers:function(t,e){var r=this;s.a.getAllResalers({region_id:t,area_id:e}).then(function(t){r.resalers=t})},readProductInfo:function(t){this.products.forEach(function(e){e.id===t.product.id&&(t.product_id=e.id,t.size=e.size,t.cost=e.cost,t.price=e.price)})},calculateTotalPrice:function(t){t.total_price=Object(d.f)((t.price-parseFloat(t.discount))*parseFloat(t.discount_rate)*t.quantity),t.total_cost=Object(d.f)(t.cost*t.quantity),t.total_profit=Object(d.f)(t.total_price-t.total_cost),this.calculateOrderPrice()},calculateOrderPrice:function(){var t=0,e=0;this.temp.products.forEach(function(r){t+=r.total_price,e+=r.total_cost}),this.temp.selectedProducts.forEach(function(r){t+=r.total_price,e+=r.total_cost}),this.temp.order_total_price=Object(d.f)(parseFloat(t)*parseFloat(this.temp.discount)+parseFloat(this.temp.shipping_cost)-parseFloat(this.temp.coupon)-parseFloat(this.temp.manual_discount)),this.temp.order_total_profit=Object(d.f)(parseFloat(this.temp.order_total_price)-parseFloat(e)-parseFloat(this.temp.shipping_cost)-parseFloat(this.temp.other_cost))},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,r=t.columnIndex;if(r<7||r>=16&&r<=23){var n={rowspan:0,colspan:0};return this.rowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(n={rowspan:t.rowSpan,colspan:1})}),n}},handleFilter:function(){this.listQuery.page=1,this.getAllSales(),this.getSalesCount()},addMoreProduct:function(){this.temp.products.push({product_type:void 0,product_sub_type:void 0,product_id:"",quantity:void 0,cost:void 0,price:void 0,discount:0,discount_rate:1,note:void 0,key:this.temp.products.length+1,total_price:0})},removeProduct:function(t){this.$delete(this.temp.products,t),this.calculateOrderPrice()},addAllProductBySubType:function(t){var e=this,r=0,n=1;1===t?(r=4,n=.9):2===t?r=8:3===t?r=5:4===t?r=16:5===t?r=17:6===t&&(r=4,n=.4),i.a.getAllProductsBySubType(r).then(function(r){r.sub_type[0].products.forEach(function(a){if(6!==t||6===t&&19!=a.id){var o={product_type:r,product_sub_type:r.sub_type[0],product_id:a.id,product:a,quantity:1,cost:a.cost,price:a.price,discount:0,discount_rate:n,note:void 0,key:e.temp.products.length+1,total_price:0};e.calculateTotalPrice(o),e.temp.products.push(o)}}),e.calculateOrderPrice()}).catch(function(t){e.$message({message:"作弊工具出问题了，请联系徐神检查",type:"error"})})},handleCreate:function(){var t=this;this.dialogFormVisible=!0,this.formType=1,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},clearFullyPaid:function(){this.listQuery.fully_paid=void 0},clearSpecialType:function(){this.listQuery.special_type=void 0},editSale:function(t){var e={id:t.id,sales_type:t.sales_type_id,order_total_price:t.order_total_price,order_total_profit:t.order_total_profit,coupon:t.coupon,discount:t.discount,manual_discount:t.manual_discount,shipping_cost:t.shipping_cost,other_cost:t.other_cost,member_id:t.member_id,sales_channel:{id:t.sales_channel_id,title:t.sales_channel_title},resaler:{id:t.resaler_id,name:t.resaler_name},event:{id:t.event_id,title:t.event_title},note:t.note,fully_paid:1===t.fully_paid,special_type:1===t.special_type,date:t.date,member:{name:t.member_name,cellphone:t.member_cellphone,searchValue:t.member_cellphone+" | "+t.member_name},products:[],selectedProducts:[],deletedProducts:[]};this.sales.forEach(function(r){r.id===t.id&&e.selectedProducts.push({sales_product_id:r.sales_product_id,title:r.product_title,product_type:{id:r.product_type_id,title:r.product_type},product_sub_type:{id:r.product_sub_type_id,title:r.product_sub_type},product_id:r.product_id,quantity:r.quantity,cost:r.per_item_cost_atm,price:r.per_item_price_atm,discount:r.per_product_discount,discount_rate:r.per_product_discount_ratio,product_note:r.product_note,key:r.product_id,total_price:r.total_price,total_cost:r.total_cost,total_profit:r.total_profit})}),this.temp=e,this.dialogFormVisible=!0,this.formType=2,this.calculateOrderPrice()},deleteSelectedProduct:function(t){this.temp.deletedProducts.push(this.temp.selectedProducts[t]),this.$delete(this.temp.selectedProducts,t),this.calculateOrderPrice()},searchMember:function(t){var e=this;this.isSearchingMember=!0,t.length>3&&l.a.searchMemberByCellphone({cellphone:t}).then(function(t){e.isSearchingMember=!1,e.members=t,e.members.forEach(function(t){t.searchValue=t.cellphone+" | "+t.name})}).catch(function(t){e.$message({message:"搜索失败，请联系徐神检查",type:"error"}),e.isSearchingMember=!1})},selectMember:function(t){this.temp.member_name=t.name,this.temp.member_cellphone=t.cellphone},addSalesOrder:function(){var t=this;this.$confirm("确定添加?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.sendAddSalesRequest()}).catch(function(){})},sendAddSalesRequest:function(){var t=this,e=this;if(this.temp.sales_type)if(0===this.temp.products.length)this.$message({message:"至少要有一个或以上的产品入库",type:"error"});else{var r={sales_data:{type:this.temp.sales_type,coupon:this.temp.coupon,discount:this.temp.discount,manual_discount:this.temp.manual_discount,shipping_cost:this.temp.shipping_cost,other_cost:this.temp.other_cost,order_total_price:this.temp.order_total_price?this.temp.order_total_price:0,order_total_profit:this.temp.order_total_profit?this.temp.order_total_profit:0,sales_channel_id:this.temp.sales_channel?this.temp.sales_channel.id:null,member_id:this.temp.member?this.temp.member.id:null,resaler_id:this.temp.resaler?this.temp.resaler.id:null,event_id:this.temp.event?this.temp.event.id:null,fully_paid:this.temp.fully_paid?1:0,special_type:this.temp.special_type?1:0,added_by:this.id,date:h()(this.temp.date).format("YYYY-MM-DD"),note:this.temp.note},product_data:[]};this.temp.products.forEach(function(t){var e={product_id:t.product_id,quantity:t.quantity,per_item_cost_atm:t.cost,per_item_price_atm:t.price,per_product_discount:t.discount,per_product_discount_ratio:t.discount_rate,total_price:t.total_price,total_cost:t.total_cost,total_profit:t.total_profit,note:t.note};r.product_data.push(e)}),this.listLoading=!0,o.a.addNewSalesRequest(r).then(function(r){e.listLoading=!1,t.$alert("库存添加成功","成功",{confirmButtonText:"确定",callback:function(e){t.page=1,t.getAllSales(),t.dialogFormVisible=!1,t.setDataBackToDefault()}})}).catch(function(t){e.$message({message:"添加库存失败，请联系徐神检查",type:"error"}),e.listLoading=!1})}else this.$message({message:"入库类型必须填写",type:"error"})},updateSalesOrder:function(){var t=this;this.$confirm("确定所有的修改?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.sendUpdateSalesRequest()}).catch(function(){})},sendUpdateSalesRequest:function(){var t=this,e=this,r={sales_data:{id:this.temp.id,type:this.temp.sales_type,coupon:this.temp.coupon,discount:this.temp.discount,manual_discount:this.temp.manual_discount,shipping_cost:this.temp.shipping_cost,other_cost:this.temp.other_cost,order_total_price:this.temp.order_total_price?this.temp.order_total_price:0,order_total_profit:this.temp.order_total_profit?this.temp.order_total_profit:0,sales_channel_id:this.temp.sales_channel.id,member_id:this.temp.member.id,resaler_id:this.temp.resaler.id,event_id:this.temp.event.id,fully_paid:this.temp.fully_paid?1:0,special_type:this.temp.special_type?1:0,added_by:this.id,date:h()(this.temp.date).format("YYYY-MM-DD"),note:this.temp.note},add_products:[],delete_products:[]};e.temp.products.forEach(function(t){if(t.product_id){var e={product_id:t.product_id,quantity:t.quantity,per_item_cost_atm:t.cost,per_item_price_atm:t.price,per_product_discount:t.discount,per_product_discount_ratio:t.discount_rate,total_price:t.total_price,total_cost:t.total_cost,total_profit:t.total_profit,note:t.note};r.add_products.push(e)}}),e.temp.deletedProducts.forEach(function(t){r.delete_products.push(t.sales_product_id)}),e.listLoading=!0,o.a.updateSales(r).then(function(r){e.listLoading=!1,e.$alert("销售订单修改成功","成功",{confirmButtonText:"确定",callback:function(r){e.page=1,e.getAllSales(),e.dialogFormVisible=!1,t.setDataBackToDefault()}})}).catch(function(t){e.$message({message:"销售订单修改失败，请联系徐神检查",type:"error"}),e.listLoading=!1})},setDataBackToDefault:function(){this.temp={id:void 0,sales_type:void 0,products:[{product_type:"",product_sub_type:"",product_id:"",quantity:0,cost:void 0,price:void 0,discount:0,discount_rate:1,note:void 0,key:1,total_price:0}],selectedProducts:[],deletedProducts:[],order_total_price:0,order_total_profit:0,coupon:0,discount:1,manual_discount:0,shipping_cost:5,other_cost:0,sales_channel:void 0,resaler_id:void 0,event_id:void 0,note:void 0,fully_paid:!0,special_type:!1,date:new Date}}}},y=(r("xj5x"),r("KHd+")),g=Object(y.a)(m,n,[],!1,null,"9314a9ea",null);g.options.__file="src/views/sales/resaler-sales-order.vue";e.default=g.exports},ZySA:function(t,e,r){"use strict";r("jUE0");var n="@@wavesContext";function a(t,e){function r(r){var n=Object.assign({},e.value),a=Object.assign({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),o=a.ele;if(o){o.style.position="relative",o.style.overflow="hidden";var i=o.getBoundingClientRect(),s=o.querySelector(".waves-ripple");switch(s?s.className="waves-ripple":((s=document.createElement("span")).className="waves-ripple",s.style.height=s.style.width=Math.max(i.width,i.height)+"px",o.appendChild(s)),a.type){case"center":s.style.top=i.height/2-s.offsetHeight/2+"px",s.style.left=i.width/2-s.offsetWidth/2+"px";break;default:s.style.top=(r.pageY-i.top-s.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",s.style.left=(r.pageX-i.left-s.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return s.style.backgroundColor=a.color,s.className="waves-ripple z-active",!1}}return t[n]?t[n].removeHandle=r:t[n]={removeHandle:r},r}var o={bind:function(t,e){t.addEventListener("click",a(t,e),!1)},update:function(t,e){t.removeEventListener("click",t[n].removeHandle,!1),t.addEventListener("click",a(t,e),!1)},unbind:function(t){t.removeEventListener("click",t[n].removeHandle,!1),t[n]=null,delete t[n]}},i=function(t){t.directive("waves",o)};window.Vue&&(window.waves=o,Vue.use(i)),o.install=i;e.a=o},jUE0:function(t,e,r){},xMja:function(t,e,r){"use strict";var n=r("DyJX");e.a={addProduct:function(t){return new Promise(function(e,r){n.a.post("product/add",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProducts:function(t){return new Promise(function(e,r){n.a.post("product/get_all_products",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductCount:function(t){return new Promise(function(e,r){n.a.post("product/get_all_products_count",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductsBySubType:function(t){return new Promise(function(e,r){n.a.post("product/get_all_products_by_sub_type",{sub_type:t}).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductType:function(){return new Promise(function(t,e){n.a.post("product/get_all_product_type").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getAllProductTypeCount:function(){return new Promise(function(t,e){n.a.post("product/get_all_product_type_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductSubType:function(t){return new Promise(function(e,r){n.a.post("product/get_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductSubType:function(t){return new Promise(function(e,r){n.a.post("product/get_all_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductSubTypeCount:function(){return new Promise(function(t,e){n.a.post("product/get_product_sub_type_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductBySubType:function(t){return new Promise(function(e,r){n.a.post("product/get_product_by_sub_type",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addProductType:function(t){return new Promise(function(e,r){n.a.post("product/add_product_type",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addProductSubType:function(t){return new Promise(function(e,r){n.a.post("product/add_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})}}},xj5x:function(t,e,r){"use strict";var n=r("79C1");r.n(n).a}}]);