(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"9R6f":function(e,t,a){"use strict";var r=a("FKJx");a.n(r).a},FKJx:function(e,t,a){},P6la:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("h2",[e._v("筛选结果")]),e._v(" "),a("el-date-picker",{staticClass:"filter-item",staticStyle:{"margin-left":"15px"},attrs:{type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份"},on:{change:e.handleFilter},model:{value:e.listQuery.date,callback:function(t){e.$set(e.listQuery,"date",t)},expression:"listQuery.date"}}),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{width:"100px","margin-left":"15px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("\n      搜索\n    ")])],1),e._v(" "),a("h2",[e._v(e._s(e.moment(this.listQuery.date[0]).format("YYYY-MM-01"))+" 至 "+e._s(e.moment(this.listQuery.date[1]).format("YYYY-MM-01"))+" 销售基本数据")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.sales,"span-method":e.objectSpanMethod,border:"",fit:""}},[a("el-table-column",{attrs:{label:"分销大区",prop:"id",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.region_title))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"大区经理",prop:"sales_type",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.region_manager_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"大区本月总销售",prop:"sales_type",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.region_total_sales?r.region_total_sales:0))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"销售地区",prop:"sales_type",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.area_title))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"地区经理",prop:"sales_type",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.area_manager_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"地区本月总销售",prop:"sales_type",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.area_total_sales?r.area_total_sales:0))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"产品分类销售",prop:"sales_type",width:"350px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-popover",{attrs:{placement:"right",width:"600",trigger:"click"}},[a("el-table",{attrs:{data:r.products_sales}},[a("el-table-column",{attrs:{width:"150",property:"product_type_id",label:"产品分类编号"}}),e._v(" "),a("el-table-column",{attrs:{width:"250",property:"product_type_title",label:"产品分类名称"}}),e._v(" "),a("el-table-column",{attrs:{width:"200",property:"total_product_sales",label:"产品分类销售额"}})],1),e._v(" "),a("el-button",{attrs:{slot:"reference"},slot:"reference"},[e._v("查看分类销售额")])],1)]}}])})],1)],1)};r._withStripped=!0;a("rGqo");var n=a("23J+"),l=a("xUCC"),s=a("ZySA"),o=(a("7Qib"),a("Mz3J")),i=a("L2JU"),d=a("wd/R"),c=a.n(d),p={name:"ComplexTable",components:{Pagination:o.a},directives:{waves:s.a},filters:{},data:function(){return{tableKey:0,listLoading:!1,sales:null,listQuery:{page:1,limit:100,date:[]},rowSpans:null,gridData:[{date:"2016-05-02",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-04",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-01",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"}]}},created:function(){this.listQuery.date=[new Date,c()().add(1,"months")]},computed:Object(n.a)({},Object(i.b)(["id","role"])),beforeRouteEnter:function(e,t,a){a(function(e){e.getReport(),a()})},methods:{calculateRowSpan:function(){var e=[],t=0;this.sales.forEach(function(a){var r=!1;if(e.forEach(function(e){e.region_id===a.region_id&&(r=!0,e.end++,e.rowSpan++,t=e.start+e.rowSpan)}),!r){var n={region_id:a.region_id,start:t,end:t+1,rowSpan:1};t++,e.push(n)}}),this.rowSpans=e},getReport:function(){var e=this;this.listLoading=!0,this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=c()(this.listQuery.date[0]).format("YYYY-MM-01"),this.listQuery.end_date=c()(this.listQuery.date[1]).format("YYYY-MM-01")),l.a.getGeneralSalesReport(this.listQuery).then(function(t){var a=[];e.listLoading=!1,t.forEach(function(e){var t=!1;if(a.forEach(function(a){if(a.area_id===e.area_id){var r={product_type_id:e.product_type_id,product_type_title:e.product_type_title,total_product_sales:e.total_product_sales};a.products_sales.push(r),t=!0}}),!t){var r={region_id:e.region_id,region_title:e.region_title,region_manager_id:e.region_manager_id,region_manager_name:e.region_manager_name,area_id:e.area_id,area_title:e.area_title,area_manager_name:e.area_manager_name,area_total_sales:e.area_total_sales,region_total_sales:e.region_total_sales,products_sales:[{product_type_id:e.product_type_id,product_type_title:e.product_type_title,total_product_sales:e.total_product_sales}]};a.push(r)}}),e.sales=a,e.calculateRowSpan()}).catch(function(t){e.$message({message:"getAllSales 读取库存失败，请联系徐神检查",type:"error"}),e.listLoading=!1})},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex;if(e.columnIndex<3){var a={rowspan:0,colspan:0};return this.rowSpans.forEach(function(e){t>=e.start&&t<e.end&&(t-e.start)%e.rowSpan==0&&(a={rowspan:e.rowSpan,colspan:1})}),a}},handleFilter:function(){this.getReport()}}},u=(a("9R6f"),a("KHd+")),_=Object(u.a)(p,r,[],!1,null,"24303d2b",null);_.options.__file="src/views/report/general-sales-report.vue";t.default=_.exports},ZySA:function(e,t,a){"use strict";a("jUE0");var r="@@wavesContext";function n(e,t){function a(a){var r=Object.assign({},t.value),n=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},r),l=n.ele;if(l){l.style.position="relative",l.style.overflow="hidden";var s=l.getBoundingClientRect(),o=l.querySelector(".waves-ripple");switch(o?o.className="waves-ripple":((o=document.createElement("span")).className="waves-ripple",o.style.height=o.style.width=Math.max(s.width,s.height)+"px",l.appendChild(o)),n.type){case"center":o.style.top=s.height/2-o.offsetHeight/2+"px",o.style.left=s.width/2-o.offsetWidth/2+"px";break;default:o.style.top=(a.pageY-s.top-o.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",o.style.left=(a.pageX-s.left-o.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return o.style.backgroundColor=n.color,o.className="waves-ripple z-active",!1}}return e[r]?e[r].removeHandle=a:e[r]={removeHandle:a},a}var l={bind:function(e,t){e.addEventListener("click",n(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[r].removeHandle,!1),e.addEventListener("click",n(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[r].removeHandle,!1),e[r]=null,delete e[r]}},s=function(e){e.directive("waves",l)};window.Vue&&(window.waves=l,Vue.use(s)),l.install=s;t.a=l},jUE0:function(e,t,a){}}]);