(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"86NN":function(t,e,n){"use strict";var r=n("DyJX");e.a={fetchAllInventorys:function(t){return new Promise(function(e,n){r.a.post("inventory/all_inventorys",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllInventoryCount:function(t){return new Promise(function(e,n){r.a.post("inventory/count_inventorys",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllInventoryTpes:function(t){return new Promise(function(e,n){var o={inventory_type:t};r.a.post("inventory/inventory_types",o).then(function(t){return e(t)}).catch(function(t){return n(t)})})},addNewInventoryRequest:function(t){return new Promise(function(e,n){r.a.post("inventory/add",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getStorage:function(){return new Promise(function(t,e){r.a.post("inventory/storage").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductStorage:function(t){return new Promise(function(e,n){var o={product_id:t};r.a.post("inventory/storage",o).then(function(t){return e(t)}).catch(function(t){return n(t)})})}}},UE2R:function(t,e,n){"use strict";var r=n("Y2ow");n.n(r).a},Y2ow:function(t,e,n){},ZySA:function(t,e,n){"use strict";n("jUE0");var r="@@wavesContext";function o(t,e){function n(n){var r=Object.assign({},e.value),o=Object.assign({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},r),u=o.ele;if(u){u.style.position="relative",u.style.overflow="hidden";var i=u.getBoundingClientRect(),c=u.querySelector(".waves-ripple");switch(c?c.className="waves-ripple":((c=document.createElement("span")).className="waves-ripple",c.style.height=c.style.width=Math.max(i.width,i.height)+"px",u.appendChild(c)),o.type){case"center":c.style.top=i.height/2-c.offsetHeight/2+"px",c.style.left=i.width/2-c.offsetWidth/2+"px";break;default:c.style.top=(n.pageY-i.top-c.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",c.style.left=(n.pageX-i.left-c.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return c.style.backgroundColor=o.color,c.className="waves-ripple z-active",!1}}return t[r]?t[r].removeHandle=n:t[r]={removeHandle:n},n}var u={bind:function(t,e){t.addEventListener("click",o(t,e),!1)},update:function(t,e){t.removeEventListener("click",t[r].removeHandle,!1),t.addEventListener("click",o(t,e),!1)},unbind:function(t){t.removeEventListener("click",t[r].removeHandle,!1),t[r]=null,delete t[r]}},i=function(t){t.directive("waves",u)};window.Vue&&(window.waves=u,Vue.use(i)),u.install=i;e.a=u},cGyR:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("h2",[t._v("筛选结果")]),t._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品类型",clearable:""},on:{change:function(e){return t.getSubType(t.listQuery.product_type)}},model:{value:t.listQuery.product_type,callback:function(e){t.$set(t.listQuery,"product_type",e)},expression:"listQuery.product_type"}},t._l(t.productTypes,function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品分类",clearable:""},on:{change:function(e){return t.getSelectedProducts(t.listQuery.product_sub_type)}},model:{value:t.listQuery.product_sub_type,callback:function(e){t.$set(t.listQuery,"product_sub_type",e)},expression:"listQuery.product_sub_type"}},t._l(t.productSubTypes,function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"150px","margin-left":"15px"},attrs:{placeholder:"产品",clearable:""},model:{value:t.listQuery.product,callback:function(e){t.$set(t.listQuery,"product",e)},expression:"listQuery.product"}},t._l(t.selectedProducts,function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(" "),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{width:"100px","margin-left":"15px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("\n      搜索\n    ")])],1),t._v(" "),n("h2",[t._v("库存详情")]),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.inventories,"span-method":t.objectSpanMethod,border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{label:"产品ID",prop:"id",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",[t._v(t._s(r.product_id))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"产品类型",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("el-tag",{staticClass:"tag",attrs:{color:r.tag_color}},[t._v(t._s(r.product_type))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"产品细类",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("el-tag",{staticClass:"sub_type_tag",attrs:{color:r.sub_type_tag_color}},[t._v(t._s(r.product_sub_type))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"产品名称",width:"200px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",{staticClass:"link-type",on:{click:function(e){return t.handleUpdate(r)}}},[t._v(t._s(r.title))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"产品型号",width:"200px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",[t._v(t._s(r.size))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"剩余数量","min-width":"300px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",{staticClass:"quantity",class:{"low-quantity":r.quantity<=300}},[t._v(t._s(r.quantity))])]}}])})],1),t._v(" "),n("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getAllStorage}})],1)};r._withStripped=!0;n("rGqo");var o=n("23J+"),u=n("86NN"),i=n("xMja"),c=n("ZySA"),a=(n("7Qib"),n("Mz3J")),s=n("L2JU"),l={name:"ComplexTable",components:{Pagination:a.a},directives:{waves:c.a},filters:{},data:function(){return{tableKey:0,inventories:null,productTypes:[],productSubTypes:[],selectedProducts:[],total:0,listLoading:!0,rowSpans:null,listQuery:{page:1,limit:10,product_type:void 0,product_sub_type:void 0,product:void 0}}},created:function(){},computed:Object(o.a)({},Object(s.b)(["id"])),beforeRouteEnter:function(t,e,n){n(function(t){t.getAllStorage(),t.getProductTypes(),n()})},methods:{getAllStorage:function(){var t=this;this.listLoading=!0,u.a.getStorage().then(function(e){t.inventories=e,t.listLoading=!1,t.calculateRowSpan()}).catch(function(e){t.$message({message:"读取库存失败，请联系徐神检查",type:"error"}),t.listLoading=!1})},getProductTypes:function(){var t=this;i.a.getAllProductType().then(function(e){t.productTypes=e})},getSubType:function(t,e){var n=this;this.listQuery.product=void 0,this.listQuery.product_sub_type=void 0,this.productSubTypes=[],this.selectedProducts=[],t&&i.a.getProductSubType({product_type_id:t}).then(function(t){n.productSubTypes=t}),e&&(e.product_sub_type=void 0,e.product_id=void 0,e.cost=void 0,e.size=void 0,e.quantity=void 0)},getSelectedProducts:function(t){var e=this;this.listQuery.product=void 0,this.selectedProducts=[],t&&i.a.getProductBySubType({product_sub_type:t}).then(function(t){e.selectedProducts=t})},handleFilter:function(){this.listQuery.page=1,this.getAllStorage()},calculateRowSpan:function(){var t=[],e=0;this.inventories.forEach(function(n){var r=!1;if(t.forEach(function(t){t.id===n.product_sub_type_id&&(r=!0,t.end++,t.rowSpan++,e=t.start+t.rowSpan)}),!r){var o={id:n.product_sub_type_id,start:e,end:e+1,rowSpan:1};e++,t.push(o)}}),this.rowSpans=t},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,n=t.columnIndex;if(1===n||2===n){var r={rowspan:0,colspan:0};return this.rowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(r={rowspan:t.rowSpan,colspan:1})}),r}}}},p=(n("UE2R"),n("KHd+")),d=Object(p.a)(l,r,[],!1,null,"fc98cdce",null);d.options.__file="src/views/inventory/storage-check.vue";e.default=d.exports},jUE0:function(t,e,n){},xMja:function(t,e,n){"use strict";var r=n("DyJX");e.a={addProduct:function(t){return new Promise(function(e,n){r.a.post("product/add",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProducts:function(t){return new Promise(function(e,n){r.a.post("product/get_all_products",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductCount:function(t){return new Promise(function(e,n){r.a.post("product/get_all_products_count",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductsBySubType:function(t){return new Promise(function(e,n){r.a.post("product/get_all_products_by_sub_type",{sub_type:t}).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductType:function(){return new Promise(function(t,e){r.a.post("product/get_all_product_type").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getAllProductTypeCount:function(){return new Promise(function(t,e){r.a.post("product/get_all_product_type_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductSubType:function(t){return new Promise(function(e,n){r.a.post("product/get_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductSubType:function(t){return new Promise(function(e,n){r.a.post("product/get_all_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductSubTypeCount:function(){return new Promise(function(t,e){r.a.post("product/get_product_sub_type_count").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductBySubType:function(t){return new Promise(function(e,n){r.a.post("product/get_product_by_sub_type",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},addProductType:function(t){return new Promise(function(e,n){r.a.post("product/add_product_type",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},addProductSubType:function(t){return new Promise(function(e,n){r.a.post("product/add_product_sub_type",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})}}}}]);