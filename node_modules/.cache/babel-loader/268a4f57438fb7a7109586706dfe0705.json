{"remainingRequest":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/babel-loader/lib/index.js!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/src/views/member/member-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/src/views/member/member-list.vue","mtime":1602303137147},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/@babel/runtime-corejs2/helpers/objectSpread2\"));\n\nvar _member = _interopRequireDefault(require(\"@/api/member\"));\n\nvar _utils = require(\"@/utils\");\n\nvar _Pagination = _interopRequireDefault(require(\"@/components/Pagination\"));\n\nvar _vuex = require(\"vuex\");\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// secondary package based on el-pagination\nvar _default = {\n  name: 'ComplexTable',\n  components: {\n    Pagination: _Pagination.default\n  },\n  filters: {},\n  data: function data() {\n    return {\n      tableKey: 0,\n      members: null,\n      total: 0,\n      listLoading: true,\n      dialogFormVisible: false,\n      formType: 1,\n      rowSpans: null,\n      listQuery: {\n        page: 1,\n        limit: 10\n      },\n      petTypes: [{\n        id: 1,\n        title: '狗'\n      }, {\n        id: 2,\n        title: '猫'\n      }],\n      petGenders: [{\n        id: 1,\n        title: '公'\n      }, {\n        id: 2,\n        title: '母'\n      }],\n      temp: {\n        name: null,\n        cellphone: null,\n        wechat_account: null,\n        taobao_account: null,\n        alipay_account: null,\n        city: null,\n        notes: null,\n        pets: [{\n          name: undefined,\n          type: undefined,\n          sub_type: undefined,\n          gender: undefined,\n          birthday: undefined\n        }]\n      }\n    };\n  },\n  created: function created() {},\n  computed: (0, _objectSpread2.default)({}, (0, _vuex.mapGetters)(['id'])),\n  beforeRouteEnter: function beforeRouteEnter(to, from, next) {\n    next(function (vm) {\n      vm.getMembers();\n      vm.getCount();\n      next();\n    });\n  },\n  methods: {\n    calculateRowSpan: function calculateRowSpan() {\n      var g = [];\n      var count = 0;\n      this.members.forEach(function (i) {\n        var found = false;\n        g.forEach(function (t) {\n          if (t.id === i.id) {\n            found = true;\n            t.end++;\n            t.rowSpan++;\n            count = t.start + t.rowSpan;\n          }\n        });\n\n        if (!found) {\n          var newT = {\n            id: i.id,\n            start: count,\n            end: count + 1,\n            rowSpan: 1\n          };\n          count++;\n          g.push(newT);\n        }\n      });\n      console.log(g);\n      this.rowSpans = g;\n    },\n    getMembers: function getMembers() {\n      var _this = this;\n\n      this.listLoading = true;\n\n      _member.default.getAllMembers(this.listQuery).then(function (response) {\n        _this.members = response;\n        _this.listLoading = false;\n\n        _this.calculateRowSpan();\n      }).catch(function (err) {\n        _this.$message({\n          message: '读取库存失败，请联系徐神检查',\n          type: 'error'\n        });\n\n        _this.listLoading = false;\n      });\n    },\n    getCount: function getCount() {\n      var _this2 = this;\n\n      _member.default.getMembersCount(this.listQuery).then(function (response) {\n        _this2.total = response.total;\n      });\n    },\n    handleCreate: function handleCreate() {\n      this.dialogFormVisible = true;\n      this.formType = 1;\n    },\n    removePet: function removePet(itemIndex) {\n      this.$delete(this.temp.pets, itemIndex);\n    },\n    addNewMember: function addNewMember() {\n      var _this3 = this;\n\n      this.$confirm('确定添加?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this3.sendNewMemberRequest();\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    sendNewMemberRequest: function sendNewMemberRequest() {\n      var _this4 = this;\n\n      if (!this.temp.cellphone || !this.temp.name) {\n        this.$message({\n          message: '必须填写姓名电话',\n          type: 'error'\n        });\n      } else {\n        this.listLoading = true;\n        var data = {\n          member_data: {\n            name: this.temp.name,\n            cellphone: this.temp.cellphone,\n            wechat_account: this.temp.wechat_account,\n            taobao_account: this.temp.taobao_account,\n            alipay_account: this.temp.alipay_account,\n            city: this.temp.city,\n            note: this.temp.note\n          },\n          pets: []\n        };\n        this.temp.pets.forEach(function (p) {\n          var d = {\n            name: p.name,\n            type: p.type,\n            sub_type: p.sub_type,\n            gender: p.gender\n          };\n\n          if (p.birthday) {\n            d.birthday = (0, _moment.default)(p.birthday).format('YYYY-MM-DD');\n          }\n\n          data.pets.push(d);\n        });\n\n        _member.default.addMember(data).then(function (response) {\n          _this4.listLoading = false;\n\n          _this4.$alert('添加成功', '成功', {\n            confirmButtonText: '确定',\n            callback: function callback(action) {\n              _this4.page = 1;\n\n              _this4.getMembers();\n\n              _this4.getCount();\n\n              _this4.dialogFormVisible = false;\n              _this4.temp = {\n                name: null,\n                cellphone: null,\n                wechat_account: null,\n                taobao_account: null,\n                alipay_account: null,\n                note: null,\n                pets: []\n              };\n            }\n          });\n        }).catch(function (err) {\n          console.log(err);\n\n          _this4.$message({\n            message: '添加失败，请联系徐神检查',\n            type: 'error'\n          });\n\n          _this4.listLoading = false;\n        });\n      }\n    },\n    editMember: function editMember(item) {\n      var _this5 = this;\n\n      console.log(item);\n      this.dialogFormVisible = true;\n      this.formType = 2;\n      this.temp = {\n        id: item.id,\n        name: item.name,\n        cellphone: item.cellphone,\n        city: item.city,\n        wechat_account: item.wechat_account,\n        taobao_account: item.taobao_account,\n        alipay_account: item.alipay_account,\n        note: item.note,\n        currentPets: [],\n        deletePets: [],\n        pets: []\n      };\n      this.members.forEach(function (m) {\n        if (m.id === item.id && m.pet_id && m.pet_id != null) {\n          _this5.temp.currentPets.push({\n            id: m.pet_id,\n            name: m.pet_name,\n            type: m.type,\n            sub_type: m.sub_type,\n            gender: m.pet_gender,\n            birthday: m.birthday\n          });\n        }\n      });\n    },\n    removePetFromEditing: function removePetFromEditing(item, itemIndex) {\n      this.$delete(this.temp.currentPets, itemIndex);\n      this.temp.deletePets.push(item);\n    },\n    updateMember: function updateMember() {\n      var _this6 = this;\n\n      this.$confirm('确定修改?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this6.sendUpdateMemberRequest();\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    sendUpdateMemberRequest: function sendUpdateMemberRequest() {\n      var _this7 = this;\n\n      if (!this.temp.cellphone || !this.temp.name) {\n        this.$message({\n          message: '必须填写姓名电话',\n          type: 'error'\n        });\n      } else {\n        this.listLoading = true;\n        var data = {\n          member_data: {\n            id: this.temp.id,\n            name: this.temp.name,\n            cellphone: this.temp.cellphone,\n            wechat_account: this.temp.wechat_account,\n            taobao_account: this.temp.taobao_account,\n            alipay_account: this.temp.alipay_account,\n            city: this.temp.city,\n            note: this.temp.note\n          },\n          add_pets: [],\n          delete_pets: this.temp.deletePets\n        };\n        this.temp.pets.forEach(function (p) {\n          var d = {\n            name: p.name,\n            type: p.type,\n            sub_type: p.sub_type,\n            gender: p.gender\n          };\n\n          if (p.birthday) {\n            d.birthday = (0, _moment.default)(p.birthday).format('YYYY-MM-DD');\n          }\n\n          data.add_pets.push(d);\n        });\n\n        _member.default.updateMember(data).then(function (response) {\n          _this7.listLoading = false;\n\n          _this7.$alert('修改成功', '成功', {\n            confirmButtonText: '确定',\n            callback: function callback(action) {\n              _this7.page = 1;\n\n              _this7.getMembers();\n\n              _this7.getCount();\n\n              _this7.dialogFormVisible = false;\n              _this7.temp = {\n                name: null,\n                cellphone: null,\n                wechat_account: null,\n                taobao_account: null,\n                alipay_account: null,\n                note: null,\n                pets: [],\n                deletePets: [],\n                currentPets: []\n              };\n            }\n          });\n        }).catch(function (err) {\n          console.log(err);\n\n          _this7.$message({\n            message: '添加失败，请联系徐神检查',\n            type: 'error'\n          });\n\n          _this7.listLoading = false;\n        });\n      }\n    },\n    handleFilter: function handleFilter() {\n      this.listQuery.page = 1;\n      this.getMembers();\n      this.getCount();\n    },\n    checkMemberDetail: function checkMemberDetail(item) {\n      console.log(item);\n      this.$router.push({\n        name: 'member-sales-detail',\n        params: {\n          id: item.id,\n          member: item\n        }\n      });\n    },\n    addMorePet: function addMorePet() {\n      this.temp.pets.push({\n        name: undefined,\n        type: undefined,\n        sub_type: undefined,\n        gender: undefined,\n        birthday: undefined\n      });\n    },\n    objectSpanMethod: function objectSpanMethod(_ref) {\n      var row = _ref.row,\n          column = _ref.column,\n          rowIndex = _ref.rowIndex,\n          columnIndex = _ref.columnIndex;\n\n      if (columnIndex <= 6 || columnIndex === 13) {\n        var data = {\n          rowspan: 0,\n          colspan: 0\n        };\n        this.rowSpans.forEach(function (i) {\n          if (rowIndex >= i.start && rowIndex < i.end && (rowIndex - i.start) % i.rowSpan === 0) {\n            data = {\n              rowspan: i.rowSpan,\n              colspan: 1\n            };\n            return;\n          }\n        });\n        return data;\n      }\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["member-list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div class=\"filter-container\">\n      <h2>筛选结果</h2>\n      <el-input v-model=\"listQuery.id\" placeholder=\"会员id\" style=\"width: 150px;\" class=\"filter-item\" @keyup.enter.native=\"handleFilter\" />\n      <el-input v-model=\"listQuery.cellphone\" placeholder=\"手机号\" style=\"width: 150px; margin-left: 15px;\" class=\"filter-item\" @keyup.enter.native=\"handleFilter\" />\n      <el-input v-model=\"listQuery.city\" placeholder=\"所在城市\" style=\"width: 150px; margin-left: 15px;\" class=\"filter-item\" @keyup.enter.native=\"handleFilter\" />\n      <el-input v-model=\"listQuery.name\" placeholder=\"姓名\" style=\"width: 150px; margin-left: 15px;\" class=\"filter-item\" @keyup.enter.native=\"handleFilter\" />\n      <el-select v-model=\"listQuery.pet_type\" placeholder=\"宠物类型\" clearable style=\"width: 150px; margin-left: 15px;\" class=\"filter-item\">\n        <el-option v-for=\"item in petTypes\" :key=\"item.id\" :label=\"item.title\" :value=\"item.id\" />\n      </el-select>\n      <el-input v-model=\"listQuery.pet_sub_type\" placeholder=\"宠物品种\" style=\"width: 150px; margin-left: 15px;\" class=\"filter-item\" @keyup.enter.native=\"handleFilter\" />\n      <el-button class=\"filter-item\" type=\"primary\" icon=\"el-icon-search\" @click=\"handleFilter\" style=\"width: 100px; margin-left: 15px;\">\n        搜索\n      </el-button>\n      <el-button class=\"filter-item\" style=\"width: 200px; margin-left: 10px;\" type=\"success\" icon=\"el-icon-edit\" @click=\"handleCreate\">\n        添加新会员\n      </el-button>\n    </div>\n    <div>\n      <h2 class=\"title\">会员列表</h2>\n    </div>\n    <el-table\n      :key=\"tableKey\"\n      v-loading=\"listLoading\"\n      :data=\"members\"\n      :span-method=\"objectSpanMethod\"\n      border\n      fit\n      highlight-current-row\n      style=\"width: 100%;\"\n    >\n      <el-table-column label=\"会员ID\" prop=\"id\" width=\"100px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.id }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"姓名\" prop=\"name\" width=\"250px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.name }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"手机号码\" prop=\"cellphone\" width=\"200px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.cellphone }}</span>\n        </template>\n      </el-table-column>\n       <el-table-column label=\"微信账号\" prop=\"wechat_account\" width=\"200px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.wechat_account }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"淘宝账号\" prop=\"taobao_account\"  width=\"200px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.taobao_account }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"支付宝账号\" prop=\"taobao_account\"  width=\"200px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.alipay_account }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"所在城市\" prop=\"city\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.city }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"总消费金额\" width=\"150px\" prop=\"total_spend\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.total_spend }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"宠物类别\" prop=\"pet_type\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.type === null ? '' : (row.type === 1 ? '狗':'猫') }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"宠物名字\" prop=\"pet_name\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.pet_name }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"宠物品种\" prop=\"pet_sub_type\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.sub_type }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"宠物性别\" prop=\"pet_gender\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.pet_gender === null ? '' : (row.pet_gender === 1 ? 'boy':'girl')}}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"宠物生日\" prop=\"birthday\" width=\"200px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <span>{{ row.birthday === null ? '' : moment(row.birthday).format('YYYY-MM-DD') }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"300px\" align=\"center\">\n        <template slot-scope=\"{row}\">\n          <el-button type=\"warning\" plain @click=\"editMember(row)\">编辑</el-button>\n          <el-button v-if=\"row.total_spend > 0\" type=\"primary\" plain @click=\"checkMemberDetail(row)\">消费详情</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <pagination v-show=\"total>0\" :total=\"total\" :page.sync=\"listQuery.page\" :limit.sync=\"listQuery.limit\" @pagination=\"getMembers\" />\n\n    <el-dialog title=\"添加新会员\" :visible.sync=\"dialogFormVisible\" width=\"80%\">\n      <el-form ref=\"dataForm\"\n        :model=\"temp\" \n        label-position=\"left\" \n        label-width=\"10px\" \n        style=\"margin-left:20px;\">\n        <div>\n          <h3 v-if=\"formType === 1\" style=\"vertical-align: top; margin-top: 0;\"> 添加新会员信息 </h3>\n          <h3 v-if=\"formType === 2\" style=\"vertical-align: top; margin-top: 0;\"> 编辑会员信息 </h3>\n          <div style=\"display: inline-block;\">\n            <div style=\" margin-bottom: 5px;\">\n              <div class=\"input-title\">客户姓名</div>\n              <div class=\"input-title\">手机号码</div>\n              <div class=\"input-title\">所在城市</div>\n              <div class=\"input-title\">姓名</div>\n              <div class=\"input-title\">微信账号</div>\n              <div class=\"input-title\">淘宝账号</div>\n              <div class=\"input-title\">支付宝账号</div>\n            </div>\n            <el-form-item label=\"\" prop=\"event\" style=\"margin-bottom: 10px;\">\n              <el-input placeholder=\"客户姓名\" v-model=\"temp.name\" style=\"width: 150px;\" class=\"filter-item\" />\n              <el-input placeholder=\"手机号码\" v-model=\"temp.cellphone\" style=\"width: 150px; margin-left:10px;\" class=\"filter-item\" />\n              <el-input placeholder=\"所在城市\" v-model=\"temp.city\" style=\"width: 150px; margin-left:10px;\" class=\"filter-item\" />\n              <el-input placeholder=\"微信账号\" v-model=\"temp.wechat_account\" style=\"width: 150px; margin-left:10px;\" class=\"filter-item\" />\n              <el-input placeholder=\"淘宝账号\" v-model=\"temp.taobao_account\" style=\"width: 150px; margin-left:10px;\" class=\"filter-item\" />\n              <el-input placeholder=\"支付宝账号\" v-model=\"temp.alipay_account\" style=\"width: 150px; margin-left:10px;\" class=\"filter-item\" />\n            </el-form-item>\n          </div>\n          <div v-if=\"temp.currentPets && temp.currentPets.length > 0\">\n            <h3 style=\"display: block; width: 100px; vertical-align: top; margin-top: 40;\"> 当前宠物信息 </h3>\n            <div style=\"display: inline-block;\">\n              <div style=\" margin-bottom: 5px;\">\n                <div class=\"input-title\">宠物ID</div>\n                <div class=\"input-title\">宠物类型</div>\n                <div class=\"input-title\">宠物名称</div>\n                <div class=\"input-title\">宠物品种</div>\n                <div class=\"input-title\">性别</div>\n                <div class=\"input-title\">生日</div>\n              </div>\n              <div v-for=\"(item, index) in temp.currentPets\" \n                label=\"\" :key=\"item.id\" prop=\"product\" style=\"margin-bottom: 10px;\">\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{item.id}}</span>\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{item.type === 1 ? '狗' : '猫'}}</span>\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{item.name}}</span>\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{item.sub_type}}</span>\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{item.gender === 1 ? '公' : '母'}}</span>\n                <span style=\"display: inline-block; width: 150px; margin-left: 10px;\">{{moment(item.birthday).format('YYYY-MM-DD')}}</span>\n                <el-button style=\"margin-left: 10px;\" type=\"danger\" icon=\"el-icon-delete\" @click=\"removePetFromEditing(item, index)\" />\n              </div>\n            </div>\n          </div>\n          <div>\n            <h3 style=\"display: block; width: 100px; vertical-align: top; margin-top: 40;\"> 宠物信息 </h3>\n            <div style=\"display: inline-block;\">\n              <div style=\" margin-bottom: 5px;\">\n                <div class=\"input-title\">宠物类型</div>\n                <div class=\"input-title\">宠物名称</div>\n                <div class=\"input-title\">宠物品种</div>\n                <div class=\"input-title\">性别</div>\n                <div class=\"input-title\">生日</div>\n              </div>\n              <el-form-item v-for=\"(item, index) in temp.pets\" \n                label=\"\" :key=\"item.id\" prop=\"product\" style=\"margin-bottom: 10px;\">\n                <el-select v-model=\"item.type\" class=\"filter-item\" style=\"width: 150px;\" placeholder=\"宠物类型\" clearable>\n                  <el-option v-for=\"item in petTypes\" :key=\"item.id\" :label=\"item.title\" :value=\"item.id\" />\n                </el-select>\n                <el-input v-model=\"item.name\" placeholder=\"宠物名称\" class=\"filter-item\" style=\"width: 150px; margin-left:10px;\" clearable  />\n                <el-input v-model=\"item.sub_type\" placeholder=\"宠物品种\" class=\"filter-item\" style=\"width: 150px; margin-left:10px;\" clearable  />\n                <el-select v-model=\"item.gender\" class=\"filter-item inventory-in-input-extra\" placeholder=\"宠物性别\" clearable>\n                  <el-option v-for=\"item in petGenders\" :key=\"item.id\" :label=\"item.title\" :value=\"item.id\" />\n                </el-select>\n                <el-date-picker\n                  v-model=\"item.birthday\"\n                  type=\"date\"\n                  style=\"width: 200px;\"\n                  placeholder=\"生日\">\n                </el-date-picker>\n                <el-button style=\"margin-left: 10px;\" type=\"danger\" icon=\"el-icon-delete\" @click=\"removePet(index)\" />\n              </el-form-item>\n              <el-form-item>\n                <el-button style=\"width: 150px;\" type=\"primary\" plain @click=\"addMorePet\">添加宠物</el-button>\n              </el-form-item>\n            </div>\n          </div>\n          <div>\n            <h3 class=\"section-title\"> 客户备注 </h3>\n            <el-input\n              type=\"textarea\"\n              :autosize=\"{ minRows: 2, maxRows: 4}\"\n              placeholder=\"备注\"\n              v-model=\"temp.note\"\n              style=\"width: 70%\" />\n          </div>\n        </div>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">\n          取消\n        </el-button>\n        <el-button v-if=\"this.formType === 1\" type=\"primary\" @click=\"addNewMember()\">\n          添加新会员\n        </el-button>\n        <el-button v-if=\"this.formType === 2\" type=\"primary\" @click=\"updateMember()\">\n          修改会员信息\n        </el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport MemberAPI from '@/api/member'\n\nimport { parseTime } from '@/utils'\nimport Pagination from '@/components/Pagination' // secondary package based on el-pagination\nimport { mapGetters } from 'vuex'\nimport moment from 'moment'\n\nexport default {\n  name: 'ComplexTable',\n  components: { Pagination },\n  filters: {},\n  data() {\n    return {\n      tableKey: 0,\n      members: null,\n      total: 0,\n      listLoading: true,\n      dialogFormVisible: false,\n      formType: 1,\n      rowSpans: null,\n      listQuery: {\n        page: 1,\n        limit: 10\n      },\n      petTypes: [\n        { id: 1, title: '狗' },\n        { id: 2, title: '猫' },\n      ],\n      petGenders: [\n        { id: 1, title: '公' },\n        { id: 2, title: '母' },\n      ],\n      temp: {\n        name: null,\n        cellphone: null,\n        wechat_account: null,\n        taobao_account: null,\n        alipay_account: null,\n        city: null,\n        notes: null,\n        pets: [{\n          name: undefined,\n          type: undefined,\n          sub_type: undefined,\n          gender: undefined,\n          birthday: undefined\n        }\n\n        ]\n      }\n    }\n  },\n  created() {\n   \n  },\n  computed: {\n    ...mapGetters([\n      'id'\n    ])\n  },\n  beforeRouteEnter (to, from, next) {\n    next(vm => { \n      vm.getMembers()\n      vm.getCount()\n      next();\n    }) \n  },\n  methods: {\n    calculateRowSpan() {\n      let g = []\n      let count = 0\n      this.members.forEach(i => {\n        let found = false\n        \n        g.forEach(t => {\n          if (t.id === i.id) {\n            found = true\n            t.end++\n            t.rowSpan++\n            count = t.start + t.rowSpan\n          }\n        })\n\n        if (!found) {\n          let newT = {\n            id: i.id,\n            start: count,\n            end: count+1,\n            rowSpan: 1\n          }\n          count++\n          g.push(newT)\n        }\n      });\n      console.log(g)\n      this.rowSpans = g;\n    },\n    getMembers() {\n      this.listLoading = true\n      MemberAPI.getAllMembers(this.listQuery)\n        .then(response => {\n          this.members = response\n          this.listLoading = false\n          this.calculateRowSpan()\n        })\n        .catch(err => {\n          this.$message({\n            message: '读取库存失败，请联系徐神检查',\n            type: 'error'\n          })\n          this.listLoading = false\n        })\n    },\n    getCount() {\n      MemberAPI.getMembersCount(this.listQuery)\n        .then(response => {\n          this.total = response.total\n        })\n    },\n    handleCreate() {\n      this.dialogFormVisible = true\n      this.formType = 1\n    },\n    removePet(itemIndex) {\n      this.$delete(this.temp.pets, itemIndex)\n    },\n    addNewMember() {\n      this.$confirm('确定添加?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.sendNewMemberRequest()\n      }).catch((err) => {   \n        console.log(err)     \n      });\n    },\n    sendNewMemberRequest() {\n      if (!this.temp.cellphone || !this.temp.name ) {\n        this.$message({\n          message: '必须填写姓名电话',\n          type: 'error'\n        })\n    } else {\n      this.listLoading = true\n      let data = {\n        member_data: {\n          name: this.temp.name,\n          cellphone: this.temp.cellphone,\n          wechat_account: this.temp.wechat_account,\n          taobao_account: this.temp.taobao_account,\n          alipay_account: this.temp.alipay_account,\n          city: this.temp.city,\n          note: this.temp.note\n        },\n        pets: [],\n      }\n      this.temp.pets.forEach(p => {\n        let d = {\n          name: p.name,\n          type: p.type,\n          sub_type: p.sub_type,\n          gender: p.gender\n        }\n        if (p.birthday) {\n          d.birthday = moment(p.birthday).format('YYYY-MM-DD')\n        }\n        data.pets.push(d)\n      })\n\n      MemberAPI.addMember(data)\n        .then(response => {\n          this.listLoading = false\n            this.$alert('添加成功', '成功', {\n              confirmButtonText: '确定',\n              callback: action => {\n                this.page = 1\n                this.getMembers()\n                this.getCount()\n                this.dialogFormVisible = false;\n                this.temp = {\n                  name: null,\n                  cellphone: null,\n                  wechat_account: null,\n                  taobao_account: null,\n                  alipay_account: null,\n                  note: null,\n                  pets: []\n                }\n              }\n            });\n        })\n        .catch(err => {\n          console.log(err)     \n          this.$message({\n            message: '添加失败，请联系徐神检查',\n            type: 'error'\n          })\n          this.listLoading = false\n        })\n      }\n    },\n    editMember(item) {\n      console.log(item)\n      this.dialogFormVisible = true\n      this.formType = 2\n      this.temp = {\n        id: item.id,\n        name: item.name,\n        cellphone: item.cellphone,\n        city: item.city,\n        wechat_account: item.wechat_account,\n        taobao_account: item.taobao_account,\n        alipay_account: item.alipay_account,\n        note: item.note,\n        currentPets: [],\n        deletePets: [],\n        pets: [],\n      } \n      this.members.forEach(m => {\n        if(m.id === item.id && m.pet_id && m.pet_id != null) {\n          this.temp.currentPets.push({\n            id: m.pet_id,\n            name: m.pet_name,\n            type: m.type,\n            sub_type: m.sub_type,\n            gender: m.pet_gender,\n            birthday: m.birthday\n          })\n        }\n      });\n    },\n    removePetFromEditing(item, itemIndex) {\n      this.$delete(this.temp.currentPets, itemIndex)\n      this.temp.deletePets.push(item)\n    },\n    updateMember() {\n      this.$confirm('确定修改?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.sendUpdateMemberRequest()\n      }).catch((err) => {   \n        console.log(err)     \n      });\n    },\n    sendUpdateMemberRequest() {\n      if (!this.temp.cellphone || !this.temp.name ) {\n        this.$message({\n          message: '必须填写姓名电话',\n          type: 'error'\n        })\n    } else {\n      this.listLoading = true\n      let data = {\n        member_data: {\n          id: this.temp.id,\n          name: this.temp.name,\n          cellphone: this.temp.cellphone,\n          wechat_account: this.temp.wechat_account,\n          taobao_account: this.temp.taobao_account,\n          alipay_account: this.temp.alipay_account,\n          city: this.temp.city,\n          note: this.temp.note\n        },\n        add_pets: [],\n        delete_pets: this.temp.deletePets\n      }\n      this.temp.pets.forEach(p => {\n        let d = {\n          name: p.name,\n          type: p.type,\n          sub_type: p.sub_type,\n          gender: p.gender\n        }\n        if (p.birthday) {\n          d.birthday = moment(p.birthday).format('YYYY-MM-DD')\n        }\n        data.add_pets.push(d)\n      })\n\n      MemberAPI.updateMember(data)\n        .then(response => {\n          this.listLoading = false\n            this.$alert('修改成功', '成功', {\n              confirmButtonText: '确定',\n              callback: action => {\n                this.page = 1\n                this.getMembers()\n                this.getCount()\n                this.dialogFormVisible = false;\n                this.temp = {\n                  name: null,\n                  cellphone: null,\n                  wechat_account: null,\n                  taobao_account: null,\n                  alipay_account: null,\n                  note: null,\n                  pets: [],\n                  deletePets: [],\n                  currentPets: []\n                }\n              }\n            });\n        })\n        .catch(err => {\n          console.log(err)     \n          this.$message({\n            message: '添加失败，请联系徐神检查',\n            type: 'error'\n          })\n          this.listLoading = false\n        })\n      }\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getMembers()\n      this.getCount()\n    },\n    checkMemberDetail(item) {\n      console.log(item)\n      this.$router.push({ name: 'member-sales-detail', params: { id: item.id, member: item } })\n    },\n    addMorePet() {\n      this.temp.pets.push({\n        name: undefined,\n        type: undefined,\n        sub_type: undefined,\n        gender: undefined,\n        birthday: undefined\n      });\n    },\n    objectSpanMethod({ row, column, rowIndex, columnIndex }) {\n      if (columnIndex <= 6 || columnIndex === 13) {\n        let data = {\n          rowspan: 0,\n          colspan: 0\n        };\n        this.rowSpans.forEach(i => {\n          if (rowIndex >= i.start && rowIndex < i.end && (rowIndex - i.start) % i.rowSpan === 0) {\n            data = {\n              rowspan: i.rowSpan,\n              colspan: 1\n            };\n            return;\n          }\n        })\n\n        return data;\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n  .title {\n    display: inline-block;\n  }\n\n  .create-button {\n    margin-left: 50px !important;\n  }\n\n  .tag {\n    color: white;\n    font-size: 14px;\n    width: 100px;\n  }\n\n  .sub_type_tag {\n    color: white;\n    font-size: 14px;\n    width: 120px;\n  }\n  .input-title {\n    display: inline-block;\n    width: 150px;\n    line-height: 25px;\n    font-size: 14px;\n    margin-left: 10px;\n  }\n</style>\n"],"sourceRoot":"src/views/member"}]}