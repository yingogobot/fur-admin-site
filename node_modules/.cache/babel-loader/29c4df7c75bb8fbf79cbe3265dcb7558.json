{"remainingRequest":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/thread-loader/dist/cjs.js!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/babel-loader/lib/index.js!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/src/views/data/sales-channel.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/src/views/data/sales-channel.vue","mtime":1576489669530},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yinxu/Desktop/Dev/Fur-Admin/fur-admin-site/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { fetchAllInventoryIn, getAllInventoryInCount, getAllInventoryInTypes, addNewInventoryRequest } from '@/api/inventory';\nimport { getAllProductType, getProductSubType, getProductBySubType as _getProductBySubType } from '@/api/product';\nimport waves from '@/directive/waves'; // waves directive\n\nimport { parseTime } from '@/utils';\nimport Pagination from '@/components/Pagination'; // secondary package based on el-pagination\n\nimport { mapGetters } from 'vuex';\nexport default {\n  name: 'ComplexTable',\n  components: {\n    Pagination: Pagination\n  },\n  directives: {\n    waves: waves\n  },\n  filters: {},\n  data: function data() {\n    return {\n      tableKey: 0,\n      inventories: null,\n      total: 0,\n      listLoading: true,\n      inventoryTypes: [],\n      productTypes: [],\n      productSubTypes: [],\n      selectedProducts: [],\n      products: [],\n      listQuery: {\n        inventory_in_id: undefined,\n        inventory_in_type: undefined,\n        page: 1,\n        limit: 10,\n        product_type: undefined,\n        product_sub_type: undefined,\n        product: undefined\n      },\n      temp: {\n        inventory_in_type: undefined,\n        products: [{\n          product_type: '',\n          product_sub_type: '',\n          product_id: '',\n          quantity: undefined,\n          cost: undefined,\n          size: '',\n          key: 1\n        }],\n        note: undefined\n      },\n      dialogFormVisible: false,\n      rowSpans: null\n    };\n  },\n  created: function created() {\n    this.getInventoryIn();\n    this.getInventoryInCount();\n    this.getProductTypes();\n    this.getInventoryInTypes();\n  },\n  computed: _objectSpread({}, mapGetters(['id'])),\n  methods: {\n    calculateRowSpan: function calculateRowSpan() {\n      var g = [];\n      var count = 0;\n      this.inventories.forEach(function (i) {\n        var found = false;\n        g.forEach(function (t) {\n          if (t.id === i.inventory_in_id) {\n            found = true;\n            t.end++;\n            t.rowSpan++;\n            count = t.start + t.rowSpan;\n          }\n        });\n\n        if (!found) {\n          var newT = {\n            id: i.inventory_in_id,\n            start: count,\n            end: count + 1,\n            rowSpan: 1\n          };\n          count++;\n          g.push(newT);\n        }\n      });\n      console.log(g);\n      this.rowSpans = g;\n    },\n    getInventoryIn: function getInventoryIn() {\n      var _this = this;\n\n      this.listLoading = true;\n      fetchAllInventoryIn({\n        filter_data: this.listQuery\n      }).then(function (response) {\n        _this.inventories = response.data;\n        _this.listLoading = false;\n\n        _this.calculateRowSpan();\n      }).catch(function (err) {\n        _this.$message({\n          message: '读取库存失败，请联系徐神检查',\n          type: 'error'\n        });\n\n        _this.listLoading = false;\n      });\n    },\n    getInventoryInTypes: function getInventoryInTypes() {\n      var _this2 = this;\n\n      getAllInventoryInTypes().then(function (response) {\n        _this2.inventoryTypes = response;\n      });\n    },\n    getInventoryInCount: function getInventoryInCount() {\n      var _this3 = this;\n\n      getAllInventoryInCount().then(function (response) {\n        _this3.total = response.total;\n      });\n    },\n    getProductTypes: function getProductTypes() {\n      var _this4 = this;\n\n      getAllProductType().then(function (response) {\n        _this4.productTypes = response;\n      });\n    },\n    getSubType: function getSubType(productType, item) {\n      var _this5 = this;\n\n      this.listQuery.product = undefined;\n      this.listQuery.product_sub_type = undefined;\n      this.productSubTypes = [];\n      this.selectedProducts = [];\n\n      if (productType) {\n        getProductSubType({\n          product_type_id: productType\n        }).then(function (response) {\n          _this5.productSubTypes = response;\n        });\n      }\n\n      if (item) {\n        item.product_sub_type = undefined;\n        item.product_id = undefined;\n        item.cost = undefined;\n        item.size = undefined;\n        item.quantity = undefined;\n      }\n    },\n    getSelectedProducts: function getSelectedProducts(subType) {\n      var _this6 = this;\n\n      this.listQuery.product = undefined;\n      this.selectedProducts = [];\n\n      if (subType) {\n        _getProductBySubType({\n          product_sub_type: subType\n        }).then(function (response) {\n          _this6.selectedProducts = response;\n        });\n      }\n    },\n    getProductBySubType: function getProductBySubType(subType, item) {\n      var _this7 = this;\n\n      if (subType) {\n        _getProductBySubType({\n          product_sub_type: subType\n        }).then(function (response) {\n          _this7.products = response;\n        });\n      }\n\n      if (item) {\n        item.product_id = undefined;\n        item.cost = undefined;\n        item.size = undefined;\n        item.quantity = undefined;\n      }\n    },\n    readProductInfo: function readProductInfo(item) {\n      this.products.forEach(function (p) {\n        if (p.id === item.product_id) {\n          item.size = p.size;\n          item.cost = p.cost;\n        }\n      });\n    },\n    objectSpanMethod: function objectSpanMethod(_ref) {\n      var row = _ref.row,\n          column = _ref.column,\n          rowIndex = _ref.rowIndex,\n          columnIndex = _ref.columnIndex;\n\n      if (columnIndex === 0 || columnIndex === 1 || columnIndex === 2 || columnIndex === 9) {\n        var data = {\n          rowspan: 0,\n          colspan: 0\n        };\n        this.rowSpans.forEach(function (i) {\n          if (rowIndex >= i.start && rowIndex < i.end && (rowIndex - i.start) % i.rowSpan === 0) {\n            data = {\n              rowspan: i.rowSpan,\n              colspan: 1\n            };\n            return;\n          }\n        });\n        return data;\n      }\n    },\n    handleFilter: function handleFilter() {\n      this.listQuery.page = 1;\n      this.getInventoryIn();\n    },\n    addMoreProduct: function addMoreProduct() {\n      this.temp.products.push({\n        product_type: '',\n        product_sub_type: '',\n        product_id: '',\n        quantity: undefined,\n        cost: undefined,\n        key: this.temp.products.length + 1\n      });\n    },\n    removeProduct: function removeProduct(itemIndex) {\n      this.$delete(this.temp.products, itemIndex);\n    },\n    handleCreate: function handleCreate() {\n      var _this8 = this;\n\n      this.dialogFormVisible = true;\n      this.$nextTick(function () {\n        _this8.$refs['dataForm'].clearValidate();\n      });\n    },\n    addNewInventory: function addNewInventory() {\n      var _this9 = this;\n\n      this.$confirm('确定添加?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this9.sendAddInventoryRequest();\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    sendAddInventoryRequest: function sendAddInventoryRequest() {\n      var _this10 = this;\n\n      if (!this.temp.inventory_in_type) {\n        this.$message({\n          message: '入库类型必须填写',\n          type: 'error'\n        });\n      } else if (this.temp.products.length === 0) {\n        this.$message({\n          message: '至少要有一个或以上的产品入库',\n          type: 'error'\n        });\n      } else {\n        var data = {\n          inventory_type: this.temp.inventory_in_type,\n          account_id: this.id,\n          product_data: [],\n          note: this.temp.note\n        };\n        this.temp.products.forEach(function (p) {\n          var d = {\n            id: p.product_id,\n            quantity: p.quantity,\n            cost: p.cost\n          };\n          data.product_data.push(d);\n        });\n        console.log(data);\n        this.listLoading = true;\n        addNewInventoryRequest(data).then(function (response) {\n          _this10.listLoading = false;\n\n          _this10.$alert('库存添加成功', '成功', {\n            confirmButtonText: '确定',\n            callback: function callback(action) {\n              _this10.page = 1;\n\n              _this10.getInventoryIn();\n\n              _this10.dialogFormVisible = false;\n              _this10.temp = {\n                inventory_in_type: undefined,\n                products: [{\n                  product_type: '',\n                  product_sub_type: '',\n                  product_id: '',\n                  quantity: undefined,\n                  cost: undefined,\n                  size: '',\n                  key: 1\n                }],\n                note: undefined\n              };\n            }\n          });\n        }).catch(function (err) {\n          console.log(err);\n\n          _this10.$message({\n            message: '添加库存失败，请联系徐神检查',\n            type: 'error'\n          });\n\n          _this10.listLoading = false;\n        });\n      }\n    }\n  }\n};",null]}