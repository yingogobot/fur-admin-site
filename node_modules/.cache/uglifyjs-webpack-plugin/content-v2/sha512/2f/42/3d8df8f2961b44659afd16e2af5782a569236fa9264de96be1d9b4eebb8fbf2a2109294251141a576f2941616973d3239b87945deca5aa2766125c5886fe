{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{\"79C1\":function(t,e,r){},\"8tky\":function(t,e,r){\"use strict\";(function(t){\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:void 0!==t||\"undefined\"!=typeof self&&self;var r,n=(function(t,e){t.exports=function t(e,r,n){var a,o,i=window,s=\"application/octet-stream\",l=n||s,c=e,u=!r&&!n&&c,d=document.createElement(\"a\"),p=function(t){return String(t)},_=i.Blob||i.MozBlob||i.WebKitBlob||p,f=r||\"download\";if(_=_.call?_.bind(i):Blob,\"true\"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(f=u.split(\"/\").pop().split(\"?\")[0],d.href=u,-1!==d.href.indexOf(u))){var h=new XMLHttpRequest;return h.open(\"GET\",u,!0),h.responseType=\"blob\",h.onload=function(e){t(e.target.response,f,s)},setTimeout(function(){h.send()},0),h}if(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&_!==p))return navigator.msSaveBlob?navigator.msSaveBlob(v(c),f):b(c);c=v(c),l=c.type||s}else if(/([\\x80-\\xff])/.test(c)){for(var m=0,y=new Uint8Array(c.length),g=y.length;m<g;++m)y[m]=c.charCodeAt(m);c=new _([y],{type:l})}function v(t){for(var e=t.split(/[:;,]/),r=e[1],n=\"base64\"==e[2]?atob:decodeURIComponent,a=n(e.pop()),o=a.length,i=0,s=new Uint8Array(o);i<o;++i)s[i]=a.charCodeAt(i);return new _([s],{type:r})}function b(t,e){if(\"download\"in d)return d.href=t,d.setAttribute(\"download\",f),d.className=\"download-js-link\",d.innerHTML=\"downloading...\",d.style.display=\"none\",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===e&&setTimeout(function(){i.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent))return/^data:/.test(t)&&(t=\"data:\"+t.replace(/^data:([\\w\\/\\-\\+]+)/,s)),window.open(t)||confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")&&(location.href=t),!0;var r=document.createElement(\"iframe\");document.body.appendChild(r),!e&&/^data:/.test(t)&&(t=\"data:\"+t.replace(/^data:([\\w\\/\\-\\+]+)/,s)),r.src=t,setTimeout(function(){document.body.removeChild(r)},333)}if(a=c instanceof _?c:new _([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(a,f);if(i.URL)b(i.URL.createObjectURL(a),!0);else{if(\"string\"==typeof a||a.constructor===p)try{return b(\"data:\"+l+\";base64,\"+i.btoa(a))}catch(t){return b(\"data:\"+l+\",\"+encodeURIComponent(a))}(o=new FileReader).onload=function(t){b(this.result)},o.readAsDataURL(a)}return!0}}(r={exports:{}},r.exports),r.exports);var a=function(t,e,r,n,a,o,i,s,l,c){\"boolean\"!=typeof i&&(l=s,s=i,i=!1);var u,d=\"function\"==typeof r?r.options:r;if(t&&t.render&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0,a&&(d.functional=!0)),n&&(d._scopeId=n),o?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||\"undefined\"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=u):e&&(u=i?function(){e.call(this,c(this.$root.$options.shadowRoot))}:function(t){e.call(this,s(t))}),u)if(d.functional){var p=d.render;d.render=function(t,e){return u.call(e),p(t,e)}}else{var _=d.beforeCreate;d.beforeCreate=_?[].concat(_,u):[u]}return r};const o={props:{type:{type:String,default:\"xls\"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:\"\"},header:{default:null},footer:{default:null},name:{type:String,default:\"data.xls\"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:\"Sheet1\"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName:()=>\"export_\"+(new Date).getTime(),downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){\"function\"==typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if(\"function\"!=typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return\"html\"===this.type?this.export(this.jsonToXLS(e),this.name.replace(\".xls\",\".html\"),\"text/html\"):\"csv\"===this.type?this.export(this.jsonToCSV(e),this.name.replace(\".xls\",\".csv\"),\"application/csv\"):this.export(this.jsonToXLS(e),this.name,\"application/vnd.ms-excel\")},export:async function(t,e,r){let a=this.base64ToBlob(t,r);\"function\"==typeof this.beforeFinish&&await this.beforeFinish(),n(a,e,r)},jsonToXLS(t){let e=\"<thead>\";const r=Object.keys(t[0]).length;let n=this;const a=this.header||this.$attrs.title;a&&(e+=this.parseExtraData(a,'<tr><th colspan=\"'+r+'\">${data}</th></tr>')),e+=\"<tr>\";for(let r in t[0])e+=\"<th>\"+r+\"</th>\";return e+=\"</tr>\",e+=\"</thead>\",e+=\"<tbody>\",t.map(function(t,r){e+=\"<tr>\";for(let r in t)e+=\"<td>\"+n.preprocessLongNum(n.valueReformattedForMultilines(t[r]))+\"</td>\";e+=\"</tr>\"}),e+=\"</tbody>\",null!=this.footer&&(e+=\"<tfoot>\",e+=this.parseExtraData(this.footer,'<tr><td colspan=\"'+r+'\">${data}</td></tr>'),e+=\"</tfoot>\"),'<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content=\"Microsoft Excel 11\"><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>'.replace(\"${table}\",e).replace(\"${worksheet}\",this.worksheet)},jsonToCSV(t){let e=this;var r=[];const n=this.header||this.$attrs.title;n&&r.push(this.parseExtraData(n,\"${data}\\r\\n\"));for(let e in t[0])r.push(e),r.push(\",\");return r.pop(),r.push(\"\\r\\n\"),t.map(function(t){for(let n in t){let a=t[n]+\"\";e.escapeCsv&&(a='=\"'+a+'\"').match(/[,\"\\n]/)&&(a='\"'+a.replace(/\\\"/g,'\"\"')+'\"'),r.push(a),r.push(\",\")}r.pop(),r.push(\"\\r\\n\")}),null!=this.footer&&r.push(this.parseExtraData(this.footer,\"${data}\\r\\n\")),r.join(\"\")},getProcessedJson(t,e){let r=this.getKeys(t,e),n=[],a=this;return t.map(function(t,e){let o={};for(let e in r){let n=r[e];o[e]=a.getValue(n,t)}n.push(o)}),n},getKeys(t,e){if(e)return e;let r={};for(let e in t[0])r[e]=e;return r},parseExtraData(t,e){let r=\"\";if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]&&(r+=e.replace(\"${data}\",t[n]));else r+=e.replace(\"${data}\",t);return r},getValue(t,e){const r=\"object\"!=typeof t?t:t.field;let n=\"string\"!=typeof r?[]:r.split(\".\"),a=this.defaultValue;return a=r?n.length>1?this.getValueFromNestedItem(e,n):this.parseValue(e[r]):e,t.hasOwnProperty(\"callback\")&&(a=this.getValueFromCallback(a,t.callback)),a},valueReformattedForMultilines:t=>\"string\"==typeof t?t.replace(/\\n/gi,\"<br/>\"):t,preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith(\"0x\"))return t;if(!isNaN(t)&&\"\"!=t&&(t>99999999999||t<1e-13))return'=\"'+t+'\"'}return t},getValueFromNestedItem(t,e){let r=t;for(let t of e)r&&(r=r[t]);return this.parseValue(r)},getValueFromCallback(t,e){if(\"function\"!=typeof e)return this.defaultValue;const r=e(t);return this.parseValue(r)},parseValue(t){return t||0===t||\"boolean\"==typeof t?t:this.defaultValue},base64ToBlob(t,e){let r=window.btoa(window.unescape(encodeURIComponent(t))),n=atob(r),a=n.length,o=new Uint8ClampedArray(a);for(;a--;)o[a]=n.charCodeAt(a);return new Blob([o],{type:e})}}};var i=function(){var t=this.$createElement;return(this._self._c||t)(\"div\",{attrs:{id:this.idName},on:{click:this.generate}},[this._t(\"default\",[this._v(\" Download \"+this._s(this.name)+\" \")])],2)};i._withStripped=!0;var s=a({render:i,staticRenderFns:[]},void 0,o,void 0,!1,void 0,void 0,void 0);e.a=s}).call(this,r(\"yLpj\"))},S4mp:function(t,e,r){\"use strict\";var n=r(\"DyJX\");e.a={getAllResalers:function(t){return new Promise(function(e,r){n.a.post(\"resaler/get_all\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalersCount:function(t){return new Promise(function(e,r){n.a.post(\"resaler/get_count\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addResaler:function(t){return new Promise(function(e,r){n.a.post(\"resaler/add\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},deleteResaler:function(t){return new Promise(function(e,r){var a={id:t};n.a.post(\"resaler/delete\",a).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllResalerRegions:function(t){return new Promise(function(e,r){n.a.post(\"resaler/get_all_regions\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerRegionsCount:function(){return new Promise(function(t,e){n.a.post(\"resaler/get_region_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},addResalerRegion:function(t){return new Promise(function(e,r){n.a.post(\"resaler/add_region\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addResalerRegionManager:function(t){return new Promise(function(e,r){n.a.post(\"resaler/add_region_manager\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},removeResalerRegionManager:function(t){return new Promise(function(e,r){n.a.post(\"resaler/remove_region_manager\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllResalerAreas:function(t){return new Promise(function(e,r){n.a.post(\"resaler/get_all_areas\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerAreasCount:function(){return new Promise(function(t,e){n.a.post(\"resaler/get_area_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},addResalerArea:function(t){return new Promise(function(e,r){n.a.post(\"resaler/add_area\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addResalerAreaManager:function(t){return new Promise(function(e,r){n.a.post(\"resaler/add_area_manager\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},removeResalerAreaManager:function(t){return new Promise(function(e,r){n.a.post(\"resaler/remove_area_manager\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getResalerTypes:function(){return new Promise(function(t,e){n.a.post(\"resaler/get_all_types\").then(function(e){return t(e)}).catch(function(t){return e(t)})})}}},Tu2r:function(t,e,r){\"use strict\";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r(\"div\",{staticClass:\"app-container\"},[r(\"div\",{staticClass:\"filter-container\"},[r(\"h2\",[t._v(\"筛选结果\")]),t._v(\" \"),r(\"el-date-picker\",{staticClass:\"filter-item\",staticStyle:{\"margin-left\":\"15px\"},attrs:{type:\"monthrange\",\"range-separator\":\"至\",\"start-placeholder\":\"开始月份\",\"end-placeholder\":\"结束月份\"},model:{value:t.listQuery.date,callback:function(e){t.$set(t.listQuery,\"date\",e)},expression:\"listQuery.date\"}}),t._v(\" \"),r(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"订单编号\"},model:{value:t.listQuery.resaler_sales_id,callback:function(e){t.$set(t.listQuery,\"resaler_sales_id\",e)},expression:\"listQuery.resaler_sales_id\"}}),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"分销大区\",clearable:\"\"},on:{change:function(e){return t.getAreas(t.listQuery.region_id)}},model:{value:t.listQuery.region_id,callback:function(e){t.$set(t.listQuery,\"region_id\",e)},expression:\"listQuery.region_id\"}},t._l(t.resalerRegions,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"分销地区\",clearable:\"\"},on:{change:function(e){return t.getResalers(t.listQuery.resaler_region_id,t.listQuery.area_id)}},model:{value:t.listQuery.area_id,callback:function(e){t.$set(t.listQuery,\"area_id\",e)},expression:\"listQuery.area_id\"}},t._l(t.resalerAreas,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"分销渠道\",clearable:\"\"},model:{value:t.listQuery.resaler_id,callback:function(e){t.$set(t.listQuery,\"resaler_id\",e)},expression:\"listQuery.resaler_id\"}},t._l(t.resalers,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"地区经理\",clearable:\"\"},model:{value:t.listQuery.area_manager_atm,callback:function(e){t.$set(t.listQuery,\"area_manager_atm\",e)},expression:\"listQuery.area_manager_atm\"}},t._l(t.areaManager,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"大区经理\",clearable:\"\"},model:{value:t.listQuery.region_manager_atm,callback:function(e){t.$set(t.listQuery,\"region_manager_atm\",e)},expression:\"listQuery.region_manager_atm\"}},t._l(t.regionManager,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"产品类型\",clearable:\"\"},on:{change:function(e){return t.getSubType(t.listQuery.product_type)}},model:{value:t.listQuery.product_type,callback:function(e){t.$set(t.listQuery,\"product_type\",e)},expression:\"listQuery.product_type\"}},t._l(t.productTypes,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"产品分类\",clearable:\"\"},on:{change:function(e){return t.getSelectedProducts(t.listQuery.product_sub_type)}},model:{value:t.listQuery.product_sub_type,callback:function(e){t.$set(t.listQuery,\"product_sub_type\",e)},expression:\"listQuery.product_sub_type\"}},t._l(t.productSubTypes,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),r(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"产品\",clearable:\"\"},model:{value:t.listQuery.product,callback:function(e){t.$set(t.listQuery,\"product\",e)},expression:\"listQuery.product\"}},t._l(t.selectedProducts,function(t){return r(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),r(\"el-button\",{directives:[{name:\"waves\",rawName:\"v-waves\"}],staticClass:\"filter-item\",staticStyle:{width:\"100px\",\"margin-left\":\"15px\"},attrs:{type:\"primary\",icon:\"el-icon-search\"},on:{click:t.handleFilter}},[t._v(\"\\n      搜索\\n    \")]),t._v(\" \"),t.dataForExcel&&t.dataForExcel.length>0?r(\"downloadexcel\",{staticClass:\"downloadExcelBtn\",attrs:{data:t.dataForExcel,\"before-finish\":t.finishDownload}},[t._v(\"\\n      导出数据到Excel\\n    \")]):t._e()],1),t._v(\" \"),r(\"h2\",[t._v(\"销售详情\")]),t._v(\" \"),r(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.listLoading,expression:\"listLoading\"}],key:t.tableKey,staticStyle:{width:\"100%\"},attrs:{data:t.sales,\"span-method\":t.objectSpanMethod,border:\"\",fit:\"\"}},[r(\"el-table-column\",{attrs:{label:\"订单ID\",prop:\"id\",width:\"80px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.id))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"分销渠道\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.name))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"订单总价\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(\"￥\"+t._s(n.order_total_revenue))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"所属地区\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.area_title))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"订单归属地区经理\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.area_manager_atm_name))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"所属大区\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.region_title))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"订单归属大区经理\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.region_manager_atm_name))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"销售时间\",prop:\"sales_type\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(t.moment(n.date).format(\"YYYY-MM-DD\")))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"产品类型\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"el-tag\",{staticClass:\"tag\",attrs:{color:n.tag_color}},[t._v(t._s(n.product_type))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"产品细类\",width:\"140px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"el-tag\",{staticClass:\"sub_type_tag\",attrs:{color:n.sub_type_tag_color}},[t._v(t._s(n.product_sub_type))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"产品名称\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",{staticClass:\"link-type\",on:{click:function(e){return t.handleUpdate(n)}}},[t._v(t._s(n.product_title))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"产品型号\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.size))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"销售数量\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.quantity))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"赠送数量\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.promotion_quantity))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"销售价格\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(\"￥\"+t._s(n.per_item_price_atm))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"单品折扣率\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(1==n.per_product_discount_ratio?\"原价\":0==n.per_product_discount_ratio?\"免费赠品\":1*Math.floor(100*n.per_product_discount_ratio)/100*10+\"折\"))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"单品总价\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(\"￥\"+t._s(n.total_price))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"支付公司\",width:\"200px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.payment_company_title))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"支付渠道\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.payment_channel_title))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"全额付款\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(1===n.fully_paid?\"是\":\"否\"))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"云仓订单编号\",width:\"200px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.deliver_tracking_code))])]}}])}),t._v(\" \"),r(\"el-table-column\",{attrs:{label:\"备注\",width:\"250px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var n=e.row;return[r(\"span\",[t._v(t._s(n.note))])]}}])}),t._v(\" \"),1===t.role?r(\"el-table-column\",{attrs:{label:\"编辑订单\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[r(\"el-button\",{attrs:{type:\"warning\",plain:\"\"},on:{click:function(r){return t.editSale(e.row)}}},[t._v(\"编辑\")])]}}],null,!1,3721199082)}):t._e()],1),t._v(\" \"),r(\"pagination\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.total>0,expression:\"total>0\"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{\"update:page\":function(e){return t.$set(t.listQuery,\"page\",e)},\"update:limit\":function(e){return t.$set(t.listQuery,\"limit\",e)},pagination:t.getAllSales}})],1)};n._withStripped=!0;r(\"f3/d\"),r(\"rGqo\");var a=r(\"23J+\"),o=r(\"xUCC\"),i=r(\"xMja\"),s=r(\"S4mp\"),l=r(\"gZTm\"),c=r(\"wk8/\"),u=r(\"ZySA\"),d=r(\"7Qib\"),p=r(\"Mz3J\"),_=r(\"L2JU\"),f=r(\"wd/R\"),h=r.n(f),m=r(\"8tky\"),y={name:\"ComplexTable\",components:{Pagination:p.a,downloadexcel:m.a},directives:{waves:u.a},filters:{},data:function(){return{tableKey:0,sales:null,dataForExcel:null,total:0,listLoading:!0,productTypes:[],productSubTypes:[],products:[],resalers:[],resalerRegions:[],resalerAreas:[],areaManager:[],regionManager:[],selectedProducts:[],listQuery:{page:1,limit:10,resaler_sales_id:void 0,product_type:void 0,product_sub_type:void 0,area_id:void 0,region_id:void 0,resaler_id:void 0,area_manager_atm:void 0,region_manager_atm:void 0},rowSpans:null}},created:function(){},computed:Object(a.a)({},Object(_.b)([\"id\",\"role\"])),beforeRouteEnter:function(t,e,r){r(function(t){t.getAllSales(),t.getSalesCount(),t.getProductTypes(),t.getResalers(),t.getAreas(),t.getRegions(),t.getSalesAreaManager(),t.getSalesRegionManager(),r()})},methods:{calculateRowSpan:function(){var t=[],e=0;this.sales.forEach(function(r){var n=!1;if(t.forEach(function(t){t.id===r.id&&(n=!0,t.end++,t.rowSpan++,e=t.start+t.rowSpan)}),!n){var a={id:r.id,start:e,end:e+1,rowSpan:1};e++,t.push(a)}}),this.rowSpans=t},getAllSales:function(){var t=this;this.listLoading=!0,this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=h()(this.listQuery.date[0]).format(\"YYYY-MM-DD\"),this.listQuery.end_date=h()(this.listQuery.date[1]).format(\"YYYY-MM-DD\")),o.a.getAllResalerSales(this.listQuery).then(function(e){t.sales=e,t.listLoading=!1,t.calculateRowSpan(),t.prepareExcelData()}).catch(function(e){t.$message({message:\"getAllSales 读取库存失败，请联系徐神检查\",type:\"error\"}),t.listLoading=!1})},getSalesCount:function(){var t=this;this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=h()(this.listQuery.date[0]).format(\"YYYY-MM-DD\"),this.listQuery.end_date=h()(this.listQuery.date[1]).format(\"YYYY-MM-DD\")),o.a.getAllResalerSalesCount(this.listQuery).then(function(e){t.total=e.total})},prepareExcelData:function(){var t=this;this.dataForExcel=[],this.sales.forEach(function(e){var r=!1;if(t.dataForExcel.forEach(function(t){t.id===e.id&&(r=!0)}),!r){var n={id:e.id,region_title:e.region_title,region_manager_atm_name:e.region_manager_atm_name,area_title:e.area_title,area_manager_atm_name:e.area_manager_atm_name,resaler_name:e.name,order_total_price:e.order_total_price,order_total_profit:e.order_total_profit,deliver_tracking_code:e.deliver_tracking_code,note:e.note};t.dataForExcel.push(n)}})},getAreas:function(t){var e=this;s.a.getAllResalerAreas({region_id:t,page:1,limit:1e4}).then(function(t){e.resalerAreas=t}).catch(function(t){})},getRegions:function(){var t=this;s.a.getAllResalerRegions({page:1,limit:1e4}).then(function(e){t.resalerRegions=e}).catch(function(t){})},getSalesAreaManager:function(){var t=this;c.a.getAccounts({role:[4,5]}).then(function(e){t.areaManager=e})},getSalesRegionManager:function(){var t=this;c.a.getAccounts({role:[5]}).then(function(e){t.regionManager=e})},getProductTypes:function(){var t=this;i.a.getAllProductType().then(function(e){t.productTypes=e})},getSubType:function(t){this.selectedProducts=[],this.listQuery.product=void 0,this.listQuery.product_sub_type=void 0,this.productSubTypes=t.product_type.sub_type,t&&(t.product_sub_type=void 0,t.product_id=void 0,t.cost=void 0,t.size=void 0,t.quantity=0,t.total_price=0,t.discount=0,t.discount_rate=1)},getSelectedProducts:function(t){var e=this;this.selectedProducts=[],this.listQuery.product=void 0,t&&i.a.getProductBySubType({product_sub_type:t}).then(function(t){e.selectedProducts=t})},getProductBySubType:function(t,e){this.products=t.products,e&&(e.product_id=void 0,e.cost=void 0,e.size=void 0,e.quantity=0,e.total_price=0,e.discount=0,e.discount_rate=1)},getResalers:function(t,e){var r=this;s.a.getAllResalers({region_id:t,area_id:e}).then(function(t){r.resalers=t})},readProductInfo:function(t){this.products.forEach(function(e){e.id===t.product.id&&(t.product_id=e.id,t.size=e.size,t.cost=e.cost,t.price=e.price)})},calculateTotalPrice:function(t){t.total_price=Object(d.f)((t.price-parseFloat(t.discount))*parseFloat(t.discount_rate)*t.quantity),t.total_cost=Object(d.f)(t.cost*t.quantity),t.total_profit=Object(d.f)(t.total_price-t.total_cost),this.calculateOrderPrice()},calculateOrderPrice:function(){var t=0,e=0;this.temp.products.forEach(function(r){t+=r.total_price,e+=r.total_cost}),this.temp.selectedProducts.forEach(function(r){t+=r.total_price,e+=r.total_cost}),this.temp.order_total_price=Object(d.f)(parseFloat(t)*parseFloat(this.temp.discount)+parseFloat(this.temp.shipping_cost)-parseFloat(this.temp.coupon)-parseFloat(this.temp.manual_discount)),this.temp.order_total_profit=Object(d.f)(parseFloat(this.temp.order_total_price)-parseFloat(e)-parseFloat(this.temp.shipping_cost)-parseFloat(this.temp.other_cost))},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,r=t.columnIndex;if(r<7||r>=16&&r<=23){var n={rowspan:0,colspan:0};return this.rowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(n={rowspan:t.rowSpan,colspan:1})}),n}},handleFilter:function(){this.listQuery.page=1,this.getAllSales(),this.getSalesCount()},addMoreProduct:function(){this.temp.products.push({product_type:void 0,product_sub_type:void 0,product_id:\"\",quantity:void 0,cost:void 0,price:void 0,discount:0,discount_rate:1,note:void 0,key:this.temp.products.length+1,total_price:0})},removeProduct:function(t){this.$delete(this.temp.products,t),this.calculateOrderPrice()},addAllProductBySubType:function(t){var e=this,r=0,n=1;1===t?(r=4,n=.9):2===t?r=8:3===t?r=5:4===t?r=16:5===t?r=17:6===t&&(r=18),i.a.getAllProductsBySubType(r).then(function(t){t.sub_type[0].products.forEach(function(r){var a={product_type:t,product_sub_type:t.sub_type[0],product_id:r.id,product:r,quantity:1,cost:r.cost,price:r.price,discount:0,discount_rate:n,note:void 0,key:e.temp.products.length+1,total_price:0};e.calculateTotalPrice(a),e.temp.products.push(a)}),e.calculateOrderPrice()}).catch(function(t){e.$message({message:\"作弊工具出问题了，请联系徐神检查\",type:\"error\"})})},handleCreate:function(){var t=this;this.dialogFormVisible=!0,this.formType=1,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},clearFullyPaid:function(){this.listQuery.fully_paid=void 0},clearSpecialType:function(){this.listQuery.special_type=void 0},editSale:function(t){var e={id:t.id,sales_type:t.sales_type_id,order_total_price:t.order_total_price,order_total_profit:t.order_total_profit,coupon:t.coupon,discount:t.discount,manual_discount:t.manual_discount,shipping_cost:t.shipping_cost,other_cost:t.other_cost,member_id:t.member_id,sales_channel:{id:t.sales_channel_id,title:t.sales_channel_title},resaler:{id:t.resaler_id,name:t.resaler_name},event:{id:t.event_id,title:t.event_title},note:t.note,fully_paid:1===t.fully_paid,special_type:1===t.special_type,date:t.date,member:{name:t.member_name,cellphone:t.member_cellphone,searchValue:t.member_cellphone+\" | \"+t.member_name},products:[],selectedProducts:[],deletedProducts:[]};this.sales.forEach(function(r){r.id===t.id&&e.selectedProducts.push({sales_product_id:r.sales_product_id,title:r.product_title,product_type:{id:r.product_type_id,title:r.product_type},product_sub_type:{id:r.product_sub_type_id,title:r.product_sub_type},product_id:r.product_id,quantity:r.quantity,cost:r.per_item_cost_atm,price:r.per_item_price_atm,discount:r.per_product_discount,discount_rate:r.per_product_discount_ratio,product_note:r.product_note,key:r.product_id,total_price:r.total_price,total_cost:r.total_cost,total_profit:r.total_profit})}),this.temp=e,this.dialogFormVisible=!0,this.formType=2,this.calculateOrderPrice()},deleteSelectedProduct:function(t){this.temp.deletedProducts.push(this.temp.selectedProducts[t]),this.$delete(this.temp.selectedProducts,t),this.calculateOrderPrice()},searchMember:function(t){var e=this;this.isSearchingMember=!0,t.length>3&&l.a.searchMemberByCellphone({cellphone:t}).then(function(t){e.isSearchingMember=!1,e.members=t,e.members.forEach(function(t){t.searchValue=t.cellphone+\" | \"+t.name})}).catch(function(t){e.$message({message:\"搜索失败，请联系徐神检查\",type:\"error\"}),e.isSearchingMember=!1})},selectMember:function(t){this.temp.member_name=t.name,this.temp.member_cellphone=t.cellphone},addSalesOrder:function(){var t=this;this.$confirm(\"确定添加?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.sendAddSalesRequest()}).catch(function(){})},sendAddSalesRequest:function(){var t=this,e=this;if(this.temp.sales_type)if(0===this.temp.products.length)this.$message({message:\"至少要有一个或以上的产品入库\",type:\"error\"});else{var r={sales_data:{type:this.temp.sales_type,coupon:this.temp.coupon,discount:this.temp.discount,manual_discount:this.temp.manual_discount,shipping_cost:this.temp.shipping_cost,other_cost:this.temp.other_cost,order_total_price:this.temp.order_total_price?this.temp.order_total_price:0,order_total_profit:this.temp.order_total_profit?this.temp.order_total_profit:0,sales_channel_id:this.temp.sales_channel?this.temp.sales_channel.id:null,member_id:this.temp.member?this.temp.member.id:null,resaler_id:this.temp.resaler?this.temp.resaler.id:null,event_id:this.temp.event?this.temp.event.id:null,fully_paid:this.temp.fully_paid?1:0,special_type:this.temp.special_type?1:0,added_by:this.id,date:h()(this.temp.date).format(\"YYYY-MM-DD\"),note:this.temp.note},product_data:[]};this.temp.products.forEach(function(t){var e={product_id:t.product_id,quantity:t.quantity,per_item_cost_atm:t.cost,per_item_price_atm:t.price,per_product_discount:t.discount,per_product_discount_ratio:t.discount_rate,total_price:t.total_price,total_cost:t.total_cost,total_profit:t.total_profit,note:t.note};r.product_data.push(e)}),this.listLoading=!0,o.a.addNewSalesRequest(r).then(function(r){e.listLoading=!1,t.$alert(\"库存添加成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(e){t.page=1,t.getAllSales(),t.dialogFormVisible=!1,t.setDataBackToDefault()}})}).catch(function(t){e.$message({message:\"添加库存失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})}else this.$message({message:\"入库类型必须填写\",type:\"error\"})},updateSalesOrder:function(){var t=this;this.$confirm(\"确定所有的修改?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.sendUpdateSalesRequest()}).catch(function(){})},sendUpdateSalesRequest:function(){var t=this,e=this,r={sales_data:{id:this.temp.id,type:this.temp.sales_type,coupon:this.temp.coupon,discount:this.temp.discount,manual_discount:this.temp.manual_discount,shipping_cost:this.temp.shipping_cost,other_cost:this.temp.other_cost,order_total_price:this.temp.order_total_price?this.temp.order_total_price:0,order_total_profit:this.temp.order_total_profit?this.temp.order_total_profit:0,sales_channel_id:this.temp.sales_channel.id,member_id:this.temp.member.id,resaler_id:this.temp.resaler.id,event_id:this.temp.event.id,fully_paid:this.temp.fully_paid?1:0,special_type:this.temp.special_type?1:0,added_by:this.id,date:h()(this.temp.date).format(\"YYYY-MM-DD\"),note:this.temp.note},add_products:[],delete_products:[]};e.temp.products.forEach(function(t){if(t.product_id){var e={product_id:t.product_id,quantity:t.quantity,per_item_cost_atm:t.cost,per_item_price_atm:t.price,per_product_discount:t.discount,per_product_discount_ratio:t.discount_rate,total_price:t.total_price,total_cost:t.total_cost,total_profit:t.total_profit,note:t.note};r.add_products.push(e)}}),e.temp.deletedProducts.forEach(function(t){r.delete_products.push(t.sales_product_id)}),e.listLoading=!0,o.a.updateSales(r).then(function(r){e.listLoading=!1,e.$alert(\"销售订单修改成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(r){e.page=1,e.getAllSales(),e.dialogFormVisible=!1,t.setDataBackToDefault()}})}).catch(function(t){e.$message({message:\"销售订单修改失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})},setDataBackToDefault:function(){this.temp={id:void 0,sales_type:void 0,products:[{product_type:\"\",product_sub_type:\"\",product_id:\"\",quantity:0,cost:void 0,price:void 0,discount:0,discount_rate:1,note:void 0,key:1,total_price:0}],selectedProducts:[],deletedProducts:[],order_total_price:0,order_total_profit:0,coupon:0,discount:1,manual_discount:0,shipping_cost:5,other_cost:0,sales_channel:void 0,resaler_id:void 0,event_id:void 0,note:void 0,fully_paid:!0,special_type:!1,date:new Date}},finishDownload:function(){alert(\"下载完成\")}}},g=(r(\"xj5x\"),r(\"KHd+\")),v=Object(g.a)(y,n,[],!1,null,\"9314a9ea\",null);v.options.__file=\"src/views/sales/resaler-sales-order.vue\";e.default=v.exports},ZySA:function(t,e,r){\"use strict\";r(\"jUE0\");var n=\"@@wavesContext\";function a(t,e){function r(r){var n=Object.assign({},e.value),a=Object.assign({ele:t,type:\"hit\",color:\"rgba(0, 0, 0, 0.15)\"},n),o=a.ele;if(o){o.style.position=\"relative\",o.style.overflow=\"hidden\";var i=o.getBoundingClientRect(),s=o.querySelector(\".waves-ripple\");switch(s?s.className=\"waves-ripple\":((s=document.createElement(\"span\")).className=\"waves-ripple\",s.style.height=s.style.width=Math.max(i.width,i.height)+\"px\",o.appendChild(s)),a.type){case\"center\":s.style.top=i.height/2-s.offsetHeight/2+\"px\",s.style.left=i.width/2-s.offsetWidth/2+\"px\";break;default:s.style.top=(r.pageY-i.top-s.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+\"px\",s.style.left=(r.pageX-i.left-s.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+\"px\"}return s.style.backgroundColor=a.color,s.className=\"waves-ripple z-active\",!1}}return t[n]?t[n].removeHandle=r:t[n]={removeHandle:r},r}var o={bind:function(t,e){t.addEventListener(\"click\",a(t,e),!1)},update:function(t,e){t.removeEventListener(\"click\",t[n].removeHandle,!1),t.addEventListener(\"click\",a(t,e),!1)},unbind:function(t){t.removeEventListener(\"click\",t[n].removeHandle,!1),t[n]=null,delete t[n]}},i=function(t){t.directive(\"waves\",o)};window.Vue&&(window.waves=o,Vue.use(i)),o.install=i;e.a=o},jUE0:function(t,e,r){},xMja:function(t,e,r){\"use strict\";var n=r(\"DyJX\");e.a={addProduct:function(t){return new Promise(function(e,r){n.a.post(\"product/add\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProducts:function(t){return new Promise(function(e,r){n.a.post(\"product/get_all_products\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductCount:function(t){return new Promise(function(e,r){n.a.post(\"product/get_all_products_count\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductsBySubType:function(t){return new Promise(function(e,r){n.a.post(\"product/get_all_products_by_sub_type\",{sub_type:t}).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductType:function(){return new Promise(function(t,e){n.a.post(\"product/get_all_product_type\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getAllProductTypeCount:function(){return new Promise(function(t,e){n.a.post(\"product/get_all_product_type_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductSubType:function(t){return new Promise(function(e,r){n.a.post(\"product/get_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductSubType:function(t){return new Promise(function(e,r){n.a.post(\"product/get_all_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getAllProductSubTypeCount:function(){return new Promise(function(t,e){n.a.post(\"product/get_product_sub_type_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductBySubType:function(t){return new Promise(function(e,r){n.a.post(\"product/get_product_by_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addProductType:function(t){return new Promise(function(e,r){n.a.post(\"product/add_product_type\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},addProductSubType:function(t){return new Promise(function(e,r){n.a.post(\"product/add_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return r(t)})})},getTestingProductsByType:function(t){return new Promise(function(e,r){n.a.post(\"product/get_testing_product_by_type\",{type:t}).then(function(t){return e(t)}).catch(function(t){return r(t)})})}}},xj5x:function(t,e,r){\"use strict\";var n=r(\"79C1\");r.n(n).a}}]);","extractedComments":[]}