{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{DAA6:function(t,e,n){\"use strict\";var o=n(\"lptv\");n.n(o).a},lptv:function(t,e,n){},pEts:function(t,e,n){\"use strict\";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"app-container\"},[n(\"div\",[n(\"h2\",{staticClass:\"title\"},[t._v(\"产品列表\")]),t._v(\" \"),7===t.role||1===t.role?n(\"el-button\",{staticClass:\"create-button\",staticStyle:{width:\"200px\",\"margin-left\":\"10px\"},attrs:{type:\"success\",icon:\"el-icon-edit\"},on:{click:t.handleCreate}},[t._v(\"\\n      添加新产品\\n    \")]):t._e()],1),t._v(\" \"),n(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.listLoading,expression:\"listLoading\"}],key:t.tableKey,staticStyle:{width:\"100%\"},attrs:{data:t.products,\"span-method\":t.objectSpanMethod,border:\"\",fit:\"\",\"highlight-current-row\":\"\"}},[n(\"el-table-column\",{attrs:{label:\"产品ID\",prop:\"id\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",[t._v(t._s(o.id))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品类型\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"el-tag\",{staticClass:\"tag\",attrs:{color:o.tag_color}},[t._v(t._s(o.product_type))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品细类\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"el-tag\",{staticClass:\"sub_type_tag\",attrs:{color:o.sub_type_tag_color}},[t._v(t._s(o.product_sub_type))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"名称\",\"min-width\":\"200px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",{staticClass:\"link-type\",on:{click:function(e){return t.handleUpdate(o)}}},[t._v(t._s(o.title))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"型号\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",[t._v(t._s(o.size))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"成本\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",[t._v(t._s(o.cost))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"零售价\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",[t._v(t._s(o.price))])]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"经销商折扣\",width:\"100px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"span\",[t._v(t._s(o.resaler_discount))])]}}])}),t._v(\" \"),7===t.role||1===t.role?n(\"el-table-column\",{attrs:{label:\"操作\",width:\"300px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var o=e.row;return[n(\"el-button\",{attrs:{type:\"primary\",plain:\"\"},on:{click:function(e){return t.editEvent(o)}}},[t._v(\"编辑\")]),t._v(\" \"),n(\"el-button\",{attrs:{type:\"danger\",plain:\"\"},on:{click:function(e){return t.deleteEvent(o)}}},[t._v(\"删除\")])]}}],null,!1,3308661319)}):t._e()],1),t._v(\" \"),n(\"pagination\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.total>0,expression:\"total>0\"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{\"update:page\":function(e){return t.$set(t.listQuery,\"page\",e)},\"update:limit\":function(e){return t.$set(t.listQuery,\"limit\",e)},pagination:t.getProducts}}),t._v(\" \"),n(\"el-dialog\",{attrs:{title:\"添加新产品\",visible:t.dialogFormVisible,width:\"80%\"},on:{\"update:visible\":function(e){t.dialogFormVisible=e}}},[n(\"el-form\",{ref:\"dataForm\",staticStyle:{\"margin-left\":\"20px\"},attrs:{model:t.temp,\"label-position\":\"left\",\"label-width\":\"10px\"}},[n(\"div\",[n(\"h3\",{staticStyle:{display:\"inline-block\",width:\"100px\",\"vertical-align\":\"top\",\"margin-top\":\"0\"}},[t._v(\" 产品信息 \")]),t._v(\" \"),n(\"div\",{staticStyle:{display:\"inline-block\"}},[n(\"div\",{staticStyle:{\"margin-left\":\"10px\",\"margin-bottom\":\"5px\"}},[n(\"div\",{staticClass:\"input-title\"},[t._v(\"产品名称\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"产品类型\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"产品细类\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"规格\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"成本\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"零售价\")]),t._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[t._v(\"经销商折扣（0-1）\")])]),t._v(\" \"),n(\"el-form-item\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{label:\"\",prop:\"event\"}},[n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"产品名称\"},model:{value:t.temp.title,callback:function(e){t.$set(t.temp,\"title\",e)},expression:\"temp.title\"}}),t._v(\" \"),n(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"产品类型\",clearable:\"\"},on:{change:function(e){return t.getSubType(t.temp.type,t.temp)},clear:function(e){return t.getSubType(t.temp.type,t.temp)}},model:{value:t.temp.type,callback:function(e){t.$set(t.temp,\"type\",e)},expression:\"temp.type\"}},t._l(t.productTypes,function(t){return n(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),n(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"产品细类\",clearable:\"\"},model:{value:t.temp.sub_type,callback:function(e){t.$set(t.temp,\"sub_type\",e)},expression:\"temp.sub_type\"}},t._l(t.selectedProductSubTypes,function(t){return n(\"el-option\",{key:t.id,attrs:{label:t.title,value:t.id}})}),1),t._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"规格\"},model:{value:t.temp.size,callback:function(e){t.$set(t.temp,\"size\",e)},expression:\"temp.size\"}}),t._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"成本\"},model:{value:t.temp.cost,callback:function(e){t.$set(t.temp,\"cost\",e)},expression:\"temp.cost\"}}),t._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"零售价\"},model:{value:t.temp.price,callback:function(e){t.$set(t.temp,\"price\",e)},expression:\"temp.price\"}}),t._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{placeholder:\"经销商折扣\"},model:{value:t.temp.resaler_discount,callback:function(e){t.$set(t.temp,\"resaler_discount\",e)},expression:\"temp.resaler_discount\"}})],1)],1),t._v(\" \"),n(\"div\",[n(\"h3\",{staticStyle:{display:\"inline-block\",width:\"100px\",\"vertical-align\":\"top\",\"margin-top\":\"0\"}},[t._v(\" 产品备注 \")]),t._v(\" \"),n(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{type:\"textarea\",autosize:{minRows:2,maxRows:4},placeholder:\"备注\"},model:{value:t.temp.note,callback:function(e){t.$set(t.temp,\"note\",e)},expression:\"temp.note\"}})],1)])]),t._v(\" \"),n(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[n(\"el-button\",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(\"\\n        取消\\n      \")]),t._v(\" \"),n(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){return t.addNewProduct()}}},[t._v(\"\\n        提交\\n      \")])],1)],1)],1)};o._withStripped=!0;n(\"rGqo\");var i=n(\"23J+\"),r=n(\"xMja\"),a=(n(\"7Qib\"),n(\"Mz3J\")),l=n(\"L2JU\"),u={name:\"ComplexTable\",components:{Pagination:a.a},filters:{},data:function(){return{tableKey:0,products:null,productTypes:null,selectedProductSubTypes:null,total:0,listLoading:!0,dialogFormVisible:!1,typeRowSpans:null,subTypeRowSpans:null,listQuery:{page:1,limit:10},temp:{title:null,type:null,sub_type:null,size:null,cost:null,price:null,note:null}}},created:function(){},computed:Object(i.a)({},Object(l.b)([\"id\"])),beforeRouteEnter:function(t,e,n){n(function(t){t.getProducts(),t.getCount(),t.getProductTypes(),n()})},methods:{calculateRowSpan:function(){var t=[],e=[],n=0,o=0;this.products.forEach(function(i){var r=!1;if(t.forEach(function(t){t.product_type_id===i.product_type_id&&(r=!0,t.end++,t.rowSpan++,n=t.start+t.rowSpan)}),!r){var a={product_type_id:i.product_type_id,start:n,end:n+1,rowSpan:1};n++,t.push(a)}var l=!1;if(e.forEach(function(t){t.product_sub_type_id===i.product_sub_type_id&&(l=!0,t.end++,t.rowSpan++,o=t.start+t.rowSpan)}),!l){var u={product_sub_type_id:i.product_sub_type_id,start:o,end:o+1,rowSpan:1};o++,e.push(u)}}),this.typeRowSpans=t,this.subTypeRowSpans=e},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,n=t.columnIndex;if(1===n){var o={rowspan:0,colspan:0};return this.typeRowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(o={rowspan:t.rowSpan,colspan:1})}),o}if(2===n){var i={rowspan:0,colspan:0};return this.subTypeRowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(i={rowspan:t.rowSpan,colspan:1})}),i}},getProducts:function(){var t=this;this.listLoading=!0,r.a.getAllProducts(this.listQuery).then(function(e){t.products=e,t.listLoading=!1,t.calculateRowSpan()}).catch(function(e){t.$message({message:\"读取库存失败，请联系徐神检查\",type:\"error\"}),t.listLoading=!1})},getCount:function(){var t=this;r.a.getAllProductCount().then(function(e){t.total=e.total})},getProductTypes:function(){var t=this;r.a.getAllProductType().then(function(e){t.productTypes=e})},getSubType:function(t){var e=this;t&&r.a.getProductSubType({product_type_id:t}).then(function(t){e.selectedProductSubTypes=t})},handleCreate:function(){this.dialogFormVisible=!0},addNewProduct:function(){var t=this;this.$confirm(\"确定添加?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.sendNewProductRequest()}).catch(function(t){})},sendNewProductRequest:function(){var t=this;this.temp.title?(this.listLoading=!0,r.a.addProduct(this.temp).then(function(e){t.listLoading=!1,t.$alert(\"添加成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(e){t.page=1,t.getProducts(),t.getCount(),t.selectedProductSubTypes=null,t.dialogFormVisible=!1,t.temp={title:null,type:null,sub_type:null,size:null,cost:null,price:null,note:null}}})}).catch(function(e){t.$message({message:\"添加失败，请联系徐神检查\",type:\"error\"}),t.listLoading=!1})):this.$message({message:\"必须填写产品名称\",type:\"error\"})},editEvent:function(){},deleteEvent:function(t){var e=this;this.$confirm(\"确定删除>>\"+t.title+\"<<吗？\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.sendDeleteEventRequest(t.id)}).catch(function(t){})},sendDeleteEventRequest:function(t){var e=this;this.listLoading=!0,EventAPI.deleteEvent(t).then(function(t){e.listLoading=!1,e.$alert(\"删除成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(t){e.page=1,e.getEvents(),e.getCount()}})}).catch(function(t){e.$message({message:\"删除失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})}}},c=(n(\"DAA6\"),n(\"KHd+\")),s=Object(c.a)(u,o,[],!1,null,\"da9eedb6\",null);s.options.__file=\"src/views/product/product.vue\";e.default=s.exports},xMja:function(t,e,n){\"use strict\";var o=n(\"DyJX\");e.a={addProduct:function(t){return new Promise(function(e,n){o.a.post(\"product/add\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProducts:function(t){return new Promise(function(e,n){o.a.post(\"product/get_all_products\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductCount:function(t){return new Promise(function(e,n){o.a.post(\"product/get_all_products_count\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductsBySubType:function(t){return new Promise(function(e,n){o.a.post(\"product/get_all_products_by_sub_type\",{sub_type:t}).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductType:function(){return new Promise(function(t,e){o.a.post(\"product/get_all_product_type\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getAllProductTypeCount:function(){return new Promise(function(t,e){o.a.post(\"product/get_all_product_type_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductSubType:function(t){return new Promise(function(e,n){o.a.post(\"product/get_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductSubType:function(t){return new Promise(function(e,n){o.a.post(\"product/get_all_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},getAllProductSubTypeCount:function(){return new Promise(function(t,e){o.a.post(\"product/get_product_sub_type_count\").then(function(e){return t(e)}).catch(function(t){return e(t)})})},getProductBySubType:function(t){return new Promise(function(e,n){o.a.post(\"product/get_product_by_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},addProductType:function(t){return new Promise(function(e,n){o.a.post(\"product/add_product_type\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})},addProductSubType:function(t){return new Promise(function(e,n){o.a.post(\"product/add_product_sub_type\",t).then(function(t){return e(t)}).catch(function(t){return n(t)})})}}}}]);","extractedComments":[]}