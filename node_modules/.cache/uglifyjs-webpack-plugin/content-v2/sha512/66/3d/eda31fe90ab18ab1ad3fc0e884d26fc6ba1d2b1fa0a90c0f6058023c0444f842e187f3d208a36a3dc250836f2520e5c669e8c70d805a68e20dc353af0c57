{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{\"5XV6\":function(e,t,n){\"use strict\";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{staticClass:\"app-container\"},[n(\"div\",[n(\"h2\",{staticClass:\"title\"},[e._v(\"分销地区\")]),e._v(\" \"),7===e.role||1===e.role?n(\"el-button\",{staticClass:\"create-button\",staticStyle:{width:\"200px\",\"margin-left\":\"10px\"},attrs:{type:\"success\",icon:\"el-icon-edit\"},on:{click:e.handleCreate}},[e._v(\"\\n      添加新分销地区\\n    \")]):e._e()],1),e._v(\" \"),n(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.listLoading,expression:\"listLoading\"}],key:e.tableKey,staticStyle:{width:\"100%\"},attrs:{data:e.resalerAreas,\"span-method\":e.objectSpanMethod,border:\"\",fit:\"\",\"highlight-current-row\":\"\"}},[n(\"el-table-column\",{attrs:{label:\"分销地区ID\",prop:\"id\",width:\"100px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"span\",[e._v(e._s(a.id))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"地区名称\",prop:\"inventory_type\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"span\",[e._v(e._s(a.title))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"地区经理\",prop:\"inventory_type\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"span\",[e._v(e._s(a.area_manager_name))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"所属大区\",prop:\"inventory_type\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"span\",[e._v(e._s(a.region_title))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"大区主管\",prop:\"inventory_type\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"span\",[e._v(e._s(a.region_manager_name))])]}}])}),e._v(\" \"),7===e.role||1===e.role?n(\"el-table-column\",{attrs:{label:\"操作\",width:\"300px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var a=t.row;return[n(\"el-button\",{attrs:{type:\"primary\",plain:\"\"},on:{click:function(t){return e.handleAddManager(a)}}},[e._v(\"修改地区经理\")])]}}],null,!1,2571736610)}):e._e()],1),e._v(\" \"),n(\"pagination\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.total>0,expression:\"total>0\"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{\"update:page\":function(t){return e.$set(e.listQuery,\"page\",t)},\"update:limit\":function(t){return e.$set(e.listQuery,\"limit\",t)},pagination:e.getAreas}}),e._v(\" \"),n(\"el-dialog\",{attrs:{title:\"添加新分销地区\",visible:e.addAreaDialogFormVisible,width:\"80%\"},on:{\"update:visible\":function(t){e.addAreaDialogFormVisible=t}}},[n(\"el-form\",{ref:\"dataForm\",staticStyle:{\"margin-left\":\"20px\"},attrs:{model:e.temp,\"label-position\":\"left\",\"label-width\":\"10px\"}},[n(\"div\",[n(\"h3\",{staticStyle:{display:\"inline-block\",width:\"100px\",\"vertical-align\":\"top\",\"margin-top\":\"0\"}},[e._v(\" 分销地区信息 \")]),e._v(\" \"),n(\"div\",{staticStyle:{display:\"inline-block\"}},[n(\"div\",{staticStyle:{\"margin-bottom\":\"5px\"}},[n(\"div\",{staticClass:\"input-title\"},[e._v(\"地区\")]),e._v(\" \"),n(\"div\",{staticClass:\"input-title\"},[e._v(\"所属大区\")])]),e._v(\" \"),n(\"el-form-item\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{label:\"\",prop:\"resaler\"}},[n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"200px\"},attrs:{placeholder:\"地区名称\"},model:{value:e.temp.title,callback:function(t){e.$set(e.temp,\"title\",t)},expression:\"temp.title\"}}),e._v(\" \"),n(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{\"value-key\":\"id\",placeholder:\"大区\",clearable:\"\"},model:{value:e.temp.region_id,callback:function(t){e.$set(e.temp,\"region_id\",t)},expression:\"temp.region_id\"}},e._l(e.resalerRegions,function(e){return n(\"el-option\",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1)],1)])]),e._v(\" \"),n(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[n(\"el-button\",{on:{click:function(t){e.addAreaDialogFormVisible=!1}}},[e._v(\"\\n        取消\\n      \")]),e._v(\" \"),n(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(t){return e.addNewResalerArea()}}},[e._v(\"\\n        提交\\n      \")])],1)],1),e._v(\" \"),n(\"el-dialog\",{attrs:{title:\"指定地区经理\",visible:e.addManagerDialogFormVisible,width:\"80%\"},on:{\"update:visible\":function(t){e.addManagerDialogFormVisible=t}}},[n(\"el-form\",{ref:\"dataForm\",staticStyle:{\"margin-left\":\"20px\"},attrs:{model:e.tempM,\"label-position\":\"left\",\"label-width\":\"10px\"}},[n(\"div\",[n(\"h3\",{staticStyle:{display:\"inline-block\",width:\"100px\",\"vertical-align\":\"top\",\"margin-top\":\"0\"}},[e._v(\" 分销地区信息 \")]),e._v(\" \"),n(\"div\",{staticStyle:{display:\"inline-block\"}},[n(\"div\",{staticStyle:{\"margin-bottom\":\"5px\"}},[n(\"div\",{staticClass:\"input-title\"},[e._v(\"经理\")])]),e._v(\" \"),n(\"el-form-item\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{label:\"\",prop:\"resaler\"}},[n(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\"},attrs:{\"value-key\":\"id\",placeholder:\"经理\",clearable:\"\"},model:{value:e.tempM.manager_id,callback:function(t){e.$set(e.tempM,\"manager_id\",t)},expression:\"tempM.manager_id\"}},e._l(e.salesAccounts,function(e){return n(\"el-option\",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)]),e._v(\" \"),n(\"div\",[n(\"el-button\",{attrs:{type:\"danger\"},on:{click:function(t){return e.removeCurrentAreaManager()}}},[e._v(\"\\n          移除当前大区经理\\n        \")])],1)]),e._v(\" \"),n(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[n(\"el-button\",{on:{click:function(t){e.addManagerDialogFormVisible=!1}}},[e._v(\"\\n        取消\\n      \")]),e._v(\" \"),n(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(t){return e.addNewResalerAreaManager()}}},[e._v(\"\\n        提交\\n      \")])],1)],1)],1)};a._withStripped=!0;n(\"rGqo\");var r=n(\"23J+\"),i=n(\"S4mp\"),o=n(\"wk8/\"),l=(n(\"7Qib\"),n(\"Mz3J\")),s=n(\"L2JU\"),c={name:\"ComplexTable\",components:{Pagination:l.a},filters:{},data:function(){return{tableKey:0,resalerAreas:null,resalerRegions:null,salesAccounts:null,total:0,listLoading:!0,addAreaDialogFormVisible:!1,addManagerDialogFormVisible:!1,rowSpans:null,listQuery:{page:1,limit:10},temp:{title:null,region_id:null},tempM:{area_id:null,manager_id:null}}},created:function(){},computed:Object(r.a)({},Object(s.b)([\"id\",\"role\"])),beforeRouteEnter:function(e,t,n){n(function(e){e.getAreas(),e.getCount(),e.getRegions(),e.getSalesAccount(),n()})},methods:{calculateRowSpan:function(){var e=[],t=0;this.resalerAreas.forEach(function(n){var a=!1;if(e.forEach(function(e){e.region_id===n.region_id&&(a=!0,e.end++,e.rowSpan++,t=e.start+e.rowSpan)}),!a){var r={region_id:n.region_id,start:t,end:t+1,rowSpan:1};t++,e.push(r)}}),this.rowSpans=e},getAreas:function(){var e=this;this.listLoading=!0,i.a.getAllResalerAreas(this.listQuery).then(function(t){e.resalerAreas=t,e.listLoading=!1,e.calculateRowSpan()}).catch(function(t){e.$message({message:\"读取库存失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})},getCount:function(){var e=this;i.a.getResalerAreasCount().then(function(t){e.total=t.total})},getRegions:function(){var e=this;i.a.getAllResalerRegions().then(function(t){e.resalerRegions=t}).catch(function(e){})},getSalesAccount:function(){var e=this;o.a.getAccounts({role:[4,5]}).then(function(t){e.salesAccounts=t})},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex;if(3==e.columnIndex){var n={rowspan:0,colspan:0};return this.rowSpans.forEach(function(e){t>=e.start&&t<e.end&&(t-e.start)%e.rowSpan==0&&(n={rowspan:e.rowSpan,colspan:1})}),n}},handleCreate:function(){this.addAreaDialogFormVisible=!0},addNewResalerArea:function(){var e=this;this.$confirm(\"确定添加?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.sendNewResalerAreaRequest()}).catch(function(e){})},sendNewResalerAreaRequest:function(){var e=this;this.temp.title&&this.temp.region_id?(this.listLoading=!0,i.a.addResalerArea(this.temp).then(function(t){e.listLoading=!1,e.$alert(\"库存添加成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(t){e.page=1,e.getAreas(),e.getCount(),e.dialogFormVisible=!1,e.temp={title:null,manager_id:null,region_id:null}}})}).catch(function(t){e.$message({message:\"添加失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})):this.$message({message:\"必须填写所有信息\",type:\"error\"})},handleAddManager:function(e){this.tempM.area_id=e.id,e.manager_id&&(this.tempM.manager_id=e.manager_id),this.addManagerDialogFormVisible=!0},addNewResalerAreaManager:function(){var e=this;this.$confirm(\"确定添加?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.sendNewResalerAreaManagerRequest()}).catch(function(e){})},sendNewResalerAreaManagerRequest:function(){var e=this;this.tempM.area_id&&this.tempM.manager_id?(this.listLoading=!0,i.a.addResalerAreaManager(this.tempM).then(function(t){e.listLoading=!1,e.$alert(\"添加成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(t){e.page=1,e.getAreas(),e.getCount(),e.addManagerDialogFormVisible=!1,e.tempM={area_id:null,manager_id:null}}})}).catch(function(t){e.$message({message:\"添加失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})):this.$message({message:\"必须填写所有信息\",type:\"error\"})},removeCurrentAreaManager:function(){var e=this;this.$confirm(\"确定要移除当前大区主管?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.sendRemoveAreaManagerRequest()}).catch(function(e){})},sendRemoveAreaManagerRequest:function(){var e=this;this.listLoading=!0,i.a.removeResalerAreaManager(this.tempM).then(function(t){e.listLoading=!1,e.$alert(\"成功移除当前大区经理\",\"成功\",{confirmButtonText:\"确定\",callback:function(t){e.page=1,e.getAreas(),e.getCount(),e.addManagerDialogFormVisible=!1,e.tempM={area_id:null,manager_id:null}}})}).catch(function(t){e.$message({message:\"添加失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})}}},u=(n(\"e571\"),n(\"KHd+\")),d=Object(u.a)(c,a,[],!1,null,\"73be0bc8\",null);d.options.__file=\"src/views/resaler/resaler-area-list.vue\";t.default=d.exports},S4mp:function(e,t,n){\"use strict\";var a=n(\"DyJX\");t.a={getAllResalers:function(e){return new Promise(function(t,n){a.a.post(\"resaler/get_all\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getResalersCount:function(){return new Promise(function(e,t){a.a.post(\"resaler/get_count\").then(function(t){return e(t)}).catch(function(e){return t(e)})})},addResaler:function(e){return new Promise(function(t,n){a.a.post(\"resaler/add\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},deleteResaler:function(e){return new Promise(function(t,n){var r={id:e};a.a.post(\"resaler/delete\",r).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getAllResalerRegions:function(e){return new Promise(function(t,n){a.a.post(\"resaler/get_all_regions\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getResalerRegionsCount:function(){return new Promise(function(e,t){a.a.post(\"resaler/get_region_count\").then(function(t){return e(t)}).catch(function(e){return t(e)})})},addResalerRegion:function(e){return new Promise(function(t,n){a.a.post(\"resaler/add_region\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},addResalerRegionManager:function(e){return new Promise(function(t,n){a.a.post(\"resaler/add_region_manager\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},removeResalerRegionManager:function(e){return new Promise(function(t,n){a.a.post(\"resaler/remove_region_manager\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getAllResalerAreas:function(e){return new Promise(function(t,n){a.a.post(\"resaler/get_all_areas\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getResalerAreasCount:function(){return new Promise(function(e,t){a.a.post(\"resaler/get_area_count\").then(function(t){return e(t)}).catch(function(e){return t(e)})})},addResalerArea:function(e){return new Promise(function(t,n){a.a.post(\"resaler/add_area\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},addResalerAreaManager:function(e){return new Promise(function(t,n){a.a.post(\"resaler/add_area_manager\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},removeResalerAreaManager:function(e){return new Promise(function(t,n){a.a.post(\"resaler/remove_area_manager\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getResalerTypes:function(){return new Promise(function(e,t){a.a.post(\"resaler/get_all_types\").then(function(t){return e(t)}).catch(function(e){return t(e)})})}}},e571:function(e,t,n){\"use strict\";var a=n(\"g3P+\");n.n(a).a},\"g3P+\":function(e,t,n){}}]);","extractedComments":[]}