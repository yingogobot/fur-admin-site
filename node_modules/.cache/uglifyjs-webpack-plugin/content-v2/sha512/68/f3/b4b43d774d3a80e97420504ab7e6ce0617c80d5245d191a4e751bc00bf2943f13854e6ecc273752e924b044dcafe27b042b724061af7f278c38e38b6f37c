{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{\"+Lc1\":function(e,t,n){\"use strict\";var r=n(\"DyJX\");t.a={getAllMarketingOrder:function(e){return new Promise(function(t,n){r.a.post(\"order/get_all\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getMarketingOrderCount:function(){return new Promise(function(e,t){r.a.post(\"order/get_count\").then(function(t){return e(t)}).catch(function(e){return t(e)})})},getMarketingOrderInReviewCount:function(){return new Promise(function(e,t){r.a.post(\"order/get_in_review_count\").then(function(t){return e(t)}).catch(function(e){return t(e)})})},addMarketingOrder:function(e){return new Promise(function(t,n){r.a.post(\"order/add\",e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},deleteMarketingOrder:function(e){return new Promise(function(t,n){var a={id:e};r.a.post(\"order/delete\",a).then(function(e){return t(e)}).catch(function(e){return n(e)})})},updateMarketingOrderDeliveryCode:function(e){return new Promise(function(t,n){r.a.post(\"order/update_delivery_code\",e).then(function(e){return t()}).catch(function(e){return n(e)})})}}},\"1zXc\":function(e,t,n){},BD7w:function(e,t,n){\"use strict\";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{staticClass:\"app-container\"},[n(\"div\",{staticClass:\"filter-container\"},[n(\"h2\",[e._v(\"筛选结果\")]),e._v(\" \"),n(\"el-date-picker\",{staticClass:\"filter-item\",attrs:{type:\"monthrange\",\"range-separator\":\"至\",\"start-placeholder\":\"开始月份\",\"end-placeholder\":\"结束月份\"},model:{value:e.listQuery.date,callback:function(t){e.$set(e.listQuery,\"date\",t)},expression:\"listQuery.date\"}}),e._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"订单编号\",clearable:\"\"},model:{value:e.listQuery.id,callback:function(t){e.$set(e.listQuery,\"id\",t)},expression:\"listQuery.id\"}}),e._v(\" \"),n(\"el-select\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"申请部门\",clearable:\"\"},on:{change:function(t){return e.getAreas(e.listQuery.region_id)}},model:{value:e.listQuery.deparmtent,callback:function(t){e.$set(e.listQuery,\"deparmtent\",t)},expression:\"listQuery.deparmtent\"}},e._l(e.departments,function(e){return n(\"el-option\",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"客户姓名\",clearable:\"\"},model:{value:e.listQuery.client_name,callback:function(t){e.$set(e.listQuery,\"client_name\",t)},expression:\"listQuery.client_name\"}}),e._v(\" \"),n(\"el-input\",{staticClass:\"filter-item \",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"邮寄地址\",clearable:\"\"},model:{value:e.listQuery.shipping_address,callback:function(t){e.$set(e.listQuery,\"shipping_address\",t)},expression:\"listQuery.shipping_address\"}}),e._v(\" \"),n(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"150px\",\"margin-left\":\"15px\"},attrs:{placeholder:\"联系方式\",clearable:\"\"},model:{value:e.listQuery.contact,callback:function(t){e.$set(e.listQuery,\"contact\",t)},expression:\"listQuery.contact\"}}),e._v(\" \"),n(\"el-button\",{directives:[{name:\"waves\",rawName:\"v-waves\"}],staticClass:\"filter-item\",staticStyle:{width:\"100px\",\"margin-left\":\"15px\"},attrs:{type:\"primary\",icon:\"el-icon-search\"},on:{click:e.handleFilter}},[e._v(\"\\n      搜索\\n    \")])],1),e._v(\" \"),n(\"h2\",[e._v(\"需要审核的订单\")]),e._v(\" \"),n(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.listLoading,expression:\"listLoading\"}],key:e.tableKey,staticStyle:{width:\"100%\"},attrs:{data:e.orders,\"span-method\":e.objectSpanMethod,border:\"\",fit:\"\"}},[n(\"el-table-column\",{attrs:{label:\"订单ID\",prop:\"id\",width:\"80px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.id))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"申请部门 - 申请人\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.department)+\" - \"+e._s(r.added_by_name))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"客户姓名\",prop:\"sales_type\",width:\"200px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.client_name))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"收件地址\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.shipping_address))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"联系方式\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.contact))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"申请时间\",prop:\"sales_type\",width:\"100px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(e.moment(r.date).format(\"YYYY-MM-DD\")))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品类型\",width:\"100px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"el-tag\",{staticClass:\"tag\",attrs:{color:r.tag_color}},[e._v(e._s(r.product_type))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品细类\",width:\"140px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"el-tag\",{staticClass:\"sub_type_tag\",attrs:{color:r.sub_type_tag_color}},[e._v(e._s(r.product_sub_type))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品名称\",width:\"150px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",{staticClass:\"link-type\",on:{click:function(t){return e.handleUpdate(r)}}},[e._v(e._s(r.product_title))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品型号\",width:\"100px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.size))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"数量\",width:\"100px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.quantity))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"产品备注\",width:\"250px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.product_note))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"仓库发货编号\",width:\"200px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.tracking_code))])]}}])}),e._v(\" \"),n(\"el-table-column\",{attrs:{label:\"备注\",width:\"250px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[n(\"span\",[e._v(e._s(r.note))])]}}])}),e._v(\" \"),7===e.role||1===e.role?n(\"el-table-column\",{attrs:{label:\"审核订单\",width:\"300px\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){var r=t.row;return[e.id===r.added_by_id?n(\"el-button\",{attrs:{type:\"danger\",plain:\"\"},on:{click:function(t){return e.deleteOrder(r)}}},[e._v(\"取消订单\")]):e._e(),e._v(\" \"),n(\"el-button\",{attrs:{type:\"primary\",plain:\"\"},on:{click:function(t){return e.updateDeliveryCode(r)}}},[e._v(\"发货\")])]}}],null,!1,1486689748)}):e._e()],1),e._v(\" \"),n(\"pagination\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.total>0,expression:\"total>0\"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{\"update:page\":function(t){return e.$set(e.listQuery,\"page\",t)},\"update:limit\":function(t){return e.$set(e.listQuery,\"limit\",t)},pagination:e.getAllInReviewMarketingOrders}})],1)};r._withStripped=!0;n(\"rGqo\");var a=n(\"23J+\"),i=n(\"+Lc1\"),l=(n(\"wk8/\"),n(\"ZySA\")),o=(n(\"7Qib\"),n(\"Mz3J\")),s=n(\"L2JU\"),c=n(\"wd/R\"),u=n.n(c),d={name:\"ComplexTable\",components:{Pagination:o.a},directives:{waves:l.a},filters:{},data:function(){return{tableKey:0,orders:null,total:0,listLoading:!0,listQuery:{page:1,limit:10,id:void 0,department:void 0,client_name:void 0,shipping_address:void 0,contact:void 0,is_delivered:0},formType:0,rowSpans:null,departments:[{id:1,name:\"运营部\"},{id:2,name:\"市场部\"},{id:3,name:\"销售部\"},{id:4,name:\"设计部\"},{id:5,name:\"产品部\"}]}},created:function(){},computed:Object(a.a)({},Object(s.b)([\"id\",\"role\"])),beforeRouteEnter:function(e,t,n){n(function(e){e.getAllInReviewMarketingOrders(),e.getAllInReviewMarketingOrdersCount(),n()})},methods:{calculateRowSpan:function(){var e=[],t=0;this.orders.forEach(function(n){var r=!1;if(e.forEach(function(e){e.id===n.id&&(r=!0,e.end++,e.rowSpan++,t=e.start+e.rowSpan)}),!r){var a={id:n.id,start:t,end:t+1,rowSpan:1};t++,e.push(a)}}),this.rowSpans=e},getAllInReviewMarketingOrders:function(){var e=this;this.listLoading=!0,this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=u()(this.listQuery.date[0]).format(\"YYYY-MM-DD\"),this.listQuery.end_date=u()(this.listQuery.date[1]).format(\"YYYY-MM-DD\")),i.a.getAllMarketingOrder(this.listQuery).then(function(t){e.orders=t,e.listLoading=!1,e.calculateRowSpan()}).catch(function(t){e.$message({message:\"getAllSales 读取库存失败，请联系徐神检查\",type:\"error\"}),e.listLoading=!1})},getAllInReviewMarketingOrdersCount:function(){var e=this;i.a.getMarketingOrderInReviewCount(this.listQuery).then(function(t){e.total=t.total})},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,n=e.columnIndex;if(n<6||n>=12){var r={rowspan:0,colspan:0};return this.rowSpans.forEach(function(e){t>=e.start&&t<e.end&&(t-e.start)%e.rowSpan==0&&(r={rowspan:e.rowSpan,colspan:1})}),r}},handleFilter:function(){this.listQuery.page=1,this.getAllInReviewMarketingOrders(),this.getAllInReviewMarketingOrdersCount()},clearFullyPaid:function(){this.listQuery.fully_paid=void 0},deleteOrder:function(){var e=this;this.$confirm(\"是否确定删除本订单\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.sendDeleteOrderRequest(item.id)}).catch(function(){})},sendDeleteOrderRequest:function(e){var t=this;this.listLoading=!0,i.a.deleteMarketingOrder({id:e}).then(function(e){t.listLoading=!1,t.$alert(\"删除成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(e){t.page=1,t.getAllInReviewMarketingOrders(),t.getAllInReviewMarketingOrdersCount()}})}).catch(function(e){t.$message({message:\"订单修改失败，请联系徐神检查\",type:\"error\"}),t.listLoading=!1})},updateDeliveryCode:function(e){var t=this;this.$prompt(\"请输入云仓发货编号\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\"}).then(function(n){var r=n.value;t.$confirm(\"确定发货编号为\"+r,\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.sendUpdateSalesDeliveryRequest(e.id,r)}).catch(function(){})}).catch(function(){t.$message({type:\"info\",message:\"取消输入\"})})},sendUpdateSalesDeliveryRequest:function(e,t){var n=this;this.listLoading=!0,i.a.updateMarketingOrderDeliveryCode({order_id:e,delivery_code:t}).then(function(e){n.listLoading=!1,n.$alert(\"订单修改成功\",\"成功\",{confirmButtonText:\"确定\",callback:function(e){n.page=1,n.getAllInReviewMarketingOrders(),n.getAllInReviewMarketingOrdersCount()}})}).catch(function(e){n.$message({message:\"订单修改失败，请联系徐神检查\",type:\"error\"}),n.listLoading=!1})}}},p=(n(\"Sz/s\"),n(\"KHd+\")),f=Object(p.a)(d,r,[],!1,null,\"0000082d\",null);f.options.__file=\"src/views/sales/in-review-marketing-order.vue\";t.default=f.exports},\"Sz/s\":function(e,t,n){\"use strict\";var r=n(\"1zXc\");n.n(r).a},ZySA:function(e,t,n){\"use strict\";n(\"jUE0\");var r=\"@@wavesContext\";function a(e,t){function n(n){var r=Object.assign({},t.value),a=Object.assign({ele:e,type:\"hit\",color:\"rgba(0, 0, 0, 0.15)\"},r),i=a.ele;if(i){i.style.position=\"relative\",i.style.overflow=\"hidden\";var l=i.getBoundingClientRect(),o=i.querySelector(\".waves-ripple\");switch(o?o.className=\"waves-ripple\":((o=document.createElement(\"span\")).className=\"waves-ripple\",o.style.height=o.style.width=Math.max(l.width,l.height)+\"px\",i.appendChild(o)),a.type){case\"center\":o.style.top=l.height/2-o.offsetHeight/2+\"px\",o.style.left=l.width/2-o.offsetWidth/2+\"px\";break;default:o.style.top=(n.pageY-l.top-o.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+\"px\",o.style.left=(n.pageX-l.left-o.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+\"px\"}return o.style.backgroundColor=a.color,o.className=\"waves-ripple z-active\",!1}}return e[r]?e[r].removeHandle=n:e[r]={removeHandle:n},n}var i={bind:function(e,t){e.addEventListener(\"click\",a(e,t),!1)},update:function(e,t){e.removeEventListener(\"click\",e[r].removeHandle,!1),e.addEventListener(\"click\",a(e,t),!1)},unbind:function(e){e.removeEventListener(\"click\",e[r].removeHandle,!1),e[r]=null,delete e[r]}},l=function(e){e.directive(\"waves\",i)};window.Vue&&(window.waves=i,Vue.use(l)),i.install=l;t.a=i},jUE0:function(e,t,n){}}]);","extractedComments":[]}