{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{IQJY:function(t,e,a){\"use strict\";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return 1===t.role||4===t.role||5===t.role||6===t.role?a(\"div\",{staticClass:\"app-container\"},[a(\"div\",{staticClass:\"filter-container\"},[a(\"h2\",{staticStyle:{display:\"inline-block\"}},[t._v(\"选择月份\")]),t._v(\" \"),a(\"el-date-picker\",{staticClass:\"filter-item\",staticStyle:{\"margin-left\":\"15px\"},attrs:{type:\"monthrange\",\"range-separator\":\"至\",\"start-placeholder\":\"开始月份\",\"end-placeholder\":\"结束月份\"},on:{change:t.handleFilter},model:{value:t.listQuery.date,callback:function(e){t.$set(t.listQuery,\"date\",e)},expression:\"listQuery.date\"}}),t._v(\" \"),a(\"el-button\",{directives:[{name:\"waves\",rawName:\"v-waves\"}],staticClass:\"filter-item\",staticStyle:{width:\"100px\",\"margin-left\":\"15px\"},attrs:{type:\"primary\",icon:\"el-icon-search\"},on:{click:t.handleFilter}},[t._v(\"\\n      搜索\\n    \")])],1),t._v(\" \"),a(\"div\",[a(\"h2\",{staticStyle:{color:\"red\",display:\"inline-block\"}},[t._v(t._s(t.name)+\" \"+t._s(t.position))]),t._v(\" \"),a(\"h2\",{staticStyle:{display:\"inline-block\"}},[t._v(\" 所负责区域 \"+t._s(t.moment(this.listQuery.date[0]).format(\"YYYY-MM-01\"))+\" 至 \"+t._s(t.moment(this.listQuery.date[1]).format(\"YYYY-MM-01\"))+\" \")]),t._v(\" \"),a(\"h2\",{staticStyle:{color:\"red\",display:\"inline-block\"}},[t._v(\"销售总额 \"+t._s(t.totalSales))])]),t._v(\" \"),5===t.role?a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.listLoading,expression:\"listLoading\"}],key:t.tableKey,staticStyle:{width:\"100%\"},attrs:{data:t.sales,\"span-method\":t.objectSpanMethod,border:\"\",fit:\"\"}},[a(\"el-table-column\",{attrs:{label:\"分销大区\",prop:\"id\",width:\"80px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.region_title))])]}}],null,!1,682204387)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"大区经理\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.region_manager_name))])]}}],null,!1,1302318472)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"大区本月总销售\",prop:\"sales_type\",width:\"150px\",align:\"center\"}},[[a(\"span\",[t._v(t._s(t.totalSales?t.totalSales:0))])]],2),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"本月提成总额\",prop:\"sales_type\",width:\"150px\",align:\"center\"}},[[a(\"span\",[t._v(t._s(t.totalCommission?t.totalCommission:0))])]],2),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"销售地区\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.area_title))])]}}],null,!1,4199390380)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"地区经理\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.area_manager_name))])]}}],null,!1,331108551)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"地区本月总销售\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.area_total_sales?l.area_total_sales:0))])]}}],null,!1,176918453)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"提成比例\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.commission_rate?100*l.commission_rate+\"%\":\"无提成\"))])]}}],null,!1,3464148401)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"提成金额\",prop:\"sales_type\",width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"span\",[t._v(t._s(l.commission_value?l.commission_value:0))])]}}],null,!1,2664697909)}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"产品分类销售\",prop:\"sales_type\",width:\"350px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){var l=e.row;return[a(\"el-popover\",{attrs:{placement:\"right\",width:\"600\",trigger:\"click\"}},[a(\"el-table\",{attrs:{data:l.products_sales}},[a(\"el-table-column\",{attrs:{width:\"150\",property:\"product_type_id\",label:\"产品分类编号\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{width:\"250\",property:\"product_type_title\",label:\"产品分类名称\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{width:\"200\",property:\"total_product_sales\",label:\"产品分类销售额\"}})],1),t._v(\" \"),a(\"el-button\",{attrs:{slot:\"reference\"},slot:\"reference\"},[t._v(\"查看分类销售额\")])],1)]}}],null,!1,2196270900)})],1):t._e()],1):a(\"div\",{staticClass:\"app-container\"},[a(\"h2\",[t._v(\" 并没有权限查看 Please Get out! \")]),t._v(\" \"),a(\"img\",{attrs:{src:t.errGif,width:\"400\",height:\"400\",alt:\"No Access\"}})])};l._withStripped=!0;a(\"rGqo\");var r=a(\"23J+\"),s=a(\"GvKO\"),n=a.n(s),o=a(\"xUCC\"),i=a(\"ZySA\"),_=(a(\"7Qib\"),a(\"Mz3J\")),c=a(\"L2JU\"),p=a(\"wd/R\"),d=a.n(p),u={name:\"ComplexTable\",components:{Pagination:_.a},directives:{waves:i.a},filters:{},data:function(){return{tableKey:0,listLoading:!1,sales:null,totalSales:0,totalCommission:0,listQuery:{page:1,limit:100,date:[]},rowSpans:null,errGif:n.a}},created:function(){this.listQuery.date=[new Date,d()().add(1,\"months\")]},computed:Object(r.a)({},Object(c.b)([\"id\",\"role\",\"name\",\"position\"])),beforeRouteEnter:function(t,e,a){a(function(t){t.getSales(),a()})},methods:{calculateRowSpan:function(){var t=[],e=0;this.sales.forEach(function(a){var l=!1;if(t.forEach(function(t){t.region_id===a.region_id&&(l=!0,t.end++,t.rowSpan++,e=t.start+t.rowSpan)}),!l){var r={region_id:a.region_id,start:e,end:e+1,rowSpan:1};e++,t.push(r)}}),this.rowSpans=t},getSales:function(){var t=this;5===this.role&&(this.listLoading=!0,this.listQuery.date&&this.listQuery.date.length>1&&(this.listQuery.start_date=d()(this.listQuery.date[0]).format(\"YYYY-MM-01\"),this.listQuery.end_date=d()(this.listQuery.date[1]).format(\"YYYY-MM-01\")),this.listQuery.region_manager_id=this.id,o.a.getRegionManagerRelatedSales(this.listQuery).then(function(e){t.listLoading=!1;var a=[],l=0,r=0;e.forEach(function(e){var s=!1;if(l+=e.total_product_sales,a.forEach(function(t){if(t.area_id===e.area_id){var a={product_type_id:e.product_type_id,product_type_title:e.product_type_title,total_product_sales:e.total_product_sales};t.products_sales.push(a),s=!0}}),!s){var n={region_id:e.region_id,region_title:e.region_title,region_manager_id:e.region_manager_id,region_manager_name:e.region_manager_name,area_id:e.area_id,area_title:e.area_title,area_manager_name:e.area_manager_name,area_total_sales:e.area_total_sales,products_sales:[{product_type_id:e.product_type_id,product_type_title:e.product_type_title,total_product_sales:e.total_product_sales}]};n.commission_rate=e.area_manager_id===t.id?.05:.01,n.commission_value=Math.floor(parseFloat(e.area_total_sales)*n.commission_rate*100)/100,r+=n.commission_value,a.push(n)}}),t.sales=a,t.totalSales=parseFloat(l).toFixed(2),t.totalCommission=parseFloat(r).toFixed(2),t.calculateRowSpan()}).catch(function(e){t.$message({message:\"getSales 读取库存失败，请联系徐神检查\",type:\"error\"}),t.listLoading=!1}))},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex;if(t.columnIndex<4){var a={rowspan:0,colspan:0};return this.rowSpans.forEach(function(t){e>=t.start&&e<t.end&&(e-t.start)%t.rowSpan==0&&(a={rowspan:t.rowSpan,colspan:1})}),a}},handleFilter:function(){this.getSales()}}},m=(a(\"wU/X\"),a(\"KHd+\")),v=Object(m.a)(u,l,[],!1,null,\"bc60a360\",null);v.options.__file=\"src/views/report/detail-sales-report.vue\";e.default=v.exports},SOeX:function(t,e,a){},\"wU/X\":function(t,e,a){\"use strict\";var l=a(\"SOeX\");a.n(l).a}}]);","extractedComments":[]}